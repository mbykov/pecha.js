!function(e){var t={};function n(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(o,s,function(t){return e[t]}.bind(null,s));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=19)}([function(e,t){e.exports=require("electron")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("path")},,function(e,t){e.exports=require("fs-extra")},function(e,t){e.exports=require("electron-clipboard-extended")},function(e,t){e.exports=require("slash")},,function(e,t){e.exports=require("split.js")},function(e,t){e.exports=require("cholok")},,,,function(e,t){e.exports=require("util")},function(e,t){e.exports=require("pouchdb")},function(e,t){e.exports=require("mousetrap")},function(e,t){e.exports=require("json5")},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("electron-is-dev")},function(e,t,n){"use strict";n.r(t);var o=n(1),s=n.n(o),i=n(0);n(13);function r(e){return document.querySelector(e)}function l(e){return document.querySelectorAll(e)}function c(e,t){let n=document.createElement(e);return t&&n.classList.add(t),n}function a(e,t){let n=document.createElement("span");return n.textContent=e,t&&n.classList.add(t),n}function u(e){if(e)for(;e.hasChildNodes();)e.removeChild(e.lastChild)}function d(e){return e.getBoundingClientRect()}function p(e,t){let n=[e.top,"px"].join(""),o=[e.left,"px"].join("");t.style.top=n,t.style.left=o}var f=n(8),h=n.n(f),g=n(9),m=n.n(g);const x={tsek:"་",connective:"འི",subordinative:"ར",narrative:"འོ",interrog:"འམ",coupling:"འི",ergative:"ས",concessive:"འང"},E=["འི","ར","འོ","འམ","འི","ས","འང"];let b=x.tsek;const v=console.log;function L(e){if(!e||!e.pars||!e.pars.length)return;let t=e.pars,n=r("#source"),o=r("#result");u(n),u(o),t.forEach(e=>{let t=function(e,t){let n=document.createElement("p");return n.textContent=e,t&&n.classList.add(t),n}();t.classList.add("tibpar"),e.forEach(e=>{let n=a(e.text);e.tib&&n.classList.add("tibphrase"),e.punct&&n.classList.add("punct")," "==e.text&&n.classList.add("space"),t.appendChild(n)}),n.appendChild(t)});l("span.tibetan")}function w(e,t){e.parentNode;if(1==t.length)C(e,t[0]);else{let n=function(e){let t,n=e[0],o=[],i=!1;for(let r=0;r<n.length;r++){let l=e.map(e=>e[r].seg);1==s.a.uniq(l).length?(o.push(n[r]),i=!0):(t||(t={seg:"",docs:[]},o.push(t)),t.seg+=n[r].seg,r<n.length-1&&(t.seg+=b))}return i?o:i}(t);v("AMBI-common:",n),n?C(e,n):function(e,t){let n=d(e);v("SHOW AMBI",t);let o=r("#ambi");u(o),o.classList.remove("is-hidden"),p({top:n.bottom+12,left:n.left},o);let s=c("ul","ambilist");o.appendChild(s),t.forEach(t=>{let n=c("li","ambiline");s.appendChild(n),t.forEach(t=>{let o=t.docs.length?a(t.seg,"tibwf"):a(t.seg,"tibphrase");n.appendChild(o),y(e)})})}(e,t)}r("#progress").classList.remove("is-shown")}function C(e,t){e.textContent="",t.forEach((n,o)=>{let s;s=n.docs.length?a(n.seg,"tibwf"):a(n.seg,"tibphrase"),e.appendChild(s),o<t.length-1&&e.appendChild(a(b,"tsek"))})}function y(e){r("#source");let t=r("#result");u(t);let n=e.textContent;t.textContent=n}const S=n(2);let q=n(4);const O=i.remote.app,R=(O.getAppPath(),O.getPath("userData")),j=i.remote.require("electron-settings"),_=console.log,A=n(14);let k=[],N=S.resolve(R,"pouch");function P(e){return k.length||D(),function(e){return Promise.all(k.map(function(t){return t.allDocs({keys:e,include_docs:!0}).then(function(e){if(!e||!e.rows)throw new Error("no dbn result");let n=s.a.compact(e.rows.map(e=>e.doc)),o=s.a.flatten(s.a.compact(n.map(e=>e.docs)));return o.length?(o.forEach(e=>{e.dname=t.dname,e.weight=t.weight}),o):[]}).catch(function(e){console.log("ERR GET DBs",e)})}))}(e)}function D(){let e=j.get("cfg");_("===setDBs CFG===",e),s.a.compact(e.map(e=>e.active?e.name:null)).forEach((e,t)=>{let n=S.resolve(R,"pouch",e),o=new A(n);o.dname=e,o.weight=t,k.push(o)})}q.ensureDirSync(N);const z=console.log,T=(n(5),n(0).remote.require("electron-settings")),M=n(15),{getCurrentWindow:B}=(n(4),n(2),n(6),n(0).remote);let F,G=[],I=0;function J(e){!function(){const e=document.querySelectorAll(".section.is-shown");Array.prototype.forEach.call(e,e=>{e.classList.remove("is-shown")}),r("#transcript").classList.add("is-hidden"),r("#ambi").classList.add("is-hidden")}(),r(["#",e].join("")).classList.add("is-shown")}function W(e){try{e=JSON.parse(JSON.stringify(e))}catch(t){z("NAV-state ERR",t),e={}}let t=e.section||"home";t||(e.section="home"),J(e.section),e.old||(e.old=!1,delete e.old,G.push(e),I=G.length-1);let n=r("#progress");"main"==t?(function(e){let t=T.get("split-sizes")||[50,50];F&&e.mono?F.collapse(1):F&&F.setSizes(t),F||(T.set("split-sizes",t),F=h()(["#source","#result"],{sizes:t,gutterSize:5,cursor:"col-resize",minSize:[0,0],onDragEnd:function(e){T.set("split-sizes",e),B().reload()}}),e.mono&&F.collapse(1),document.addEventListener("keydown",function(e){},!1),document.addEventListener("wheel",function(e){},!1))}(e),L(e)):n.classList.remove("is-shown"),e={section:"home"},T.set("state",e)}M.bind(["alt+left","alt+right"],function(e){37==e.which?function(){if(I<=0)return;I--;let e=G[I];e.old=!0,W(e)}():39==e.which&&function(){if(I>=G.length-1)return;I++;let e=G[I];e.old=!0,W(e)}()}),M.bind(["alt+1","alt+2"],function(e){}),M.bind(["esc"],function(e){}),M.bind(["ctrl+k"],function(e){z("CLICK CLONE"),function(){k.length||D();let e=s.a.find(k,e=>"vasilyev"==e.dname);_("DB-name",e.dname);let t=new A("http://localhost:5984/vasilyev");e.replicate.to(t).on("complete",function(){_("yay, were done!")}).on("error",function(e){_("boo, something went wrong!",e)})}()}),M.bind(["ctrl+p"],function(e){z("ZERO CFG"),T.set("cfg","")});console.log;let U={zho:"([一-鿿]+)",tib:"([ༀ-࿿]+)",grc:"([Ͱ-Ͽἀ-῿̀-ͯ']+)"};console.log;const V=x.tsek;function Z(e){let t,n,o=[];for(let s=1;s<e.length+1;s++){let i={head:t=e.slice(0,s),tail:n=e.slice(s)};n.length&&o.push(i)}return o.reverse()}const K=console.log;function H(e){r("#progress").classList.add("is-shown");let t=e.textContent.trim(),n=(t.split(x.tsek),!1);e.parentNode.classList.contains("tibphrase")&&(n=!0);let o=function(e,t){let n=e.split(V),o=e,i=(n.length,[[n]]);!function e(n,r){Z(n).forEach(n=>{r.push(n.head),r.push(n.tail),s.a.flatten(r).join(V)==o&&(i.push(s.a.clone(r)),r.pop()),t&&r.length<2&&e(n.tail,r),r.pop()})}(n,[]);let r=[];return i.forEach(e=>{let t=[];e.forEach(e=>{t.push(e.join(V))}),r.push(t)}),r}(t,n);P(function(e){return s.a.uniq(s.a.flatten(e))}(o)).then(t=>{t=s.a.flatten(t);let n=function(e,t){let n=[];return e.forEach(e=>{let o=[],i=!1;e.forEach(e=>{let n=s.a.filter(t,t=>(function(e,t){if(e==t)return!0;let n=new RegExp("^"+t),o=e.replace(n,"");return!(e==o||!E.includes(o))})(e,t.dict));n.length&&(i=!0);let r={seg:e,docs:n};o.push(r)}),i&&n.push(o)}),n}(o,t),i=function(e){let t=[];return e.forEach(e=>{let n=!0;e.forEach(e=>{e.docs.length||(n=!1)}),n&&t.push(e)}),t}(n);K("chains: ",n.length,"fulls: ",i.length),i.length&&(n=i);let l=function(e){let t=s.a.max(e.map(e=>s.a.sum(e.map(e=>e.docs.length?e.seg.length:0))/e.length)),n=s.a.filter(e,e=>s.a.sum(e.map(e=>e.docs.length?e.seg.length:0))/e.length>=t-1),o=s.a.min(n.map(e=>e.length));return s.a.filter(n,e=>e.length==o)}(n);K("bests =>",l.length,l),l.length?w(e,l):function(e){v("NO RESULT",e.textContent),u(r("#result")),r("#progress").classList.remove("is-shown")}(e)})}const Q=console.log;function X(e){Q("PARSE STAR DICT")}function Y(e){Q("PARSE STAR CSV")}const $=n(0).remote.require("electron-settings"),ee=(n(16),n(17),n(6),console.log),te=(n(2),n(5)),{dialog:ne,getCurrentWindow:oe}=n(0).remote;n(18);r("#new-version");let se=r("#container");l('link[rel="import"]').forEach(e=>{let t=e.import.querySelector(".section");se.appendChild(t.cloneNode(!0))}),i.ipcRenderer.on("section",function(e,t){W({section:t})}),i.ipcRenderer.on("action",function(e,t){"stardict"==t?ne.showOpenDialog({properties:["openFile"],filters:[{name:"JSON",extensions:["stardict"]}]},X):"csv"==t?ne.showOpenDialog({properties:["openFile"],filters:[{name:"JSON",extensions:["stardict"]}]},Y):"cleanupdb"==t&&_("CLEAN UP")});let ie=$.get("state");ie||(ie={section:"home"}),W(ie),document.addEventListener("click",e=>{let t=e.target.dataset;if(t)if(t.external){let t=e.target.textContent;i.shell.openExternal(t)}else t.section&&W({section:t.section})}),document.addEventListener("mouseover",function(e){e.target.textContent&&(e.target.classList.contains("tibphrase")?1==e.shiftKey?function(e){let t=d(e),n=m()(e.textContent),o={top:t.top-40,left:t.left+15},s=r("#transcript");s.textContent=n,s.classList.remove("is-hidden"),p(o,s)}(e.target):H(e.target):e.target.classList.contains("tibwf")&&y(e.target))},!1),document.addEventListener("mouseleave",function(e){if(e.target.classList)if(e.target.classList.contains("tibphrase")){r("#transcript").classList.add("is-hidden")}else if(e.target.classList.contains("ambi")){ee("MOUSE LEAVE"),r("#ambi").classList.add("is-hidden")}},!1),document.addEventListener("keyup",function(e){r("#transcript").classList.add("is-hidden"),r("#ambi").classList.add("is-hidden")},!1),te.on("text-changed",()=>{let e=((e,t)=>{let n=new RegExp(U[e]);if(!n.test(t))return;let o=t.trim().replace(/᾽/g,"'"),i=o.split("'").join("");if(!n.test(i))return;let r=new RegExp("([.,!:;·།])"),l=o.replace(/\r?\n+/,"\n").split("\n"),c=(l.map(e=>e.split(r)),[]);return l.forEach(t=>{let o=[];t.split(r).forEach(t=>{if(r.test(t)){let e={text:t,punct:!0};o.push(e)}else{let i=t.split(n);(i=s.a.compact(i)).forEach(t=>{let s={text:t};!!n.test(t)&&(s[e]=!0),o.push(s)})}}),c.push(o)}),c})("tib",te.readText());e&&e.length&&W({section:"main",pars:e})}).startWatching(),function(){let e=j.get("cfg");e||(e=function(e,t){_("__ZERO CFG__");let n=S.resolve(e,"pouch"),o=q.readdirSync(n),s=[];return o.forEach((e,t)=>{if("cfg.json"==e)return;S.resolve(n,e);let o={name:e,active:!0,idx:t};s.push(o)}),j.set("cfg",s),_("__ZERO CFG__",s),s}(R))}()}]);
//# sourceMappingURL=app.js.map