!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=31)}([function(t,e){t.exports=require("electron")},function(t,e){t.exports=require("lodash")},function(t,e,n){"use strict";n.d(e,"b",function(){return i}),n.d(e,"a",function(){return s});const i={tsek:"་"},s=["འི","ར","འོ","འམ","འི","ས","འང"]},function(t,e){t.exports=require("path")},function(t,e){t.exports=require("electron-settings")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i;(i=n(8))&&i.__esModule;var s=n(1),r=(console.log,n(7)("app"),{zho:"([一-鿿]+)",tib:"([ༀ-࿿]+)",grc:"([Ͱ-Ͽἀ-῿̀-ͯ' ]+)"});e.default=function(t,e){var n=new RegExp(r[e]);if(n.test(t)){var i=t.trim().replace(/᾽/g,"'"),o=i.split("'").join("");if(n.test(o)){var c=new RegExp("([.,!:;·།])"),a=i.replace(/\r?\n+/,"\n").split("\n"),d=(a.map(function(t){return t.split(c)}),[]);return a.forEach(function(t){var i=[];t.split(c).forEach(function(t){if(c.test(t)){var r={text:t,punct:!0};i.push(r)}else{var o=t.split(n);(o=s.compact(o)).forEach(function(t){if(t=t.trim()){var s={text:t};!!n.test(t)&&(s.lang=e),i.push(s)}})}}),d.push(i)}),d}}}},,function(t,e){t.exports=require("debug")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default=function(){return"new message"}},function(t,e){t.exports=require("electron-is-dev")},function(t,e){t.exports=require("pouchdb")},function(t,e){t.exports=require("cholok")},function(t,e){t.exports=require("electron-clipboard-extended")},function(t,e){t.exports=require("slash")},,function(t,e){t.exports=require("split.js")},,,,,,,,,,function(t,e){t.exports=require("util")},function(t,e){t.exports=require("pouchdb-authentication")},function(t,e){t.exports=require("mousetrap")},function(t,e){t.exports=require("json5")},function(t,e){t.exports=require("axios")},,function(t,e,n){"use strict";n.r(e);var i=n(1),s=n.n(i),r=n(0);n(25);function o(t){return document.querySelector(t)}function c(t){return document.querySelectorAll(t)}function a(t,e){let n=document.createElement(t);return e&&n.classList.add(e),n}function d(t,e){let n=document.createElement("span");return n.textContent=t,e&&n.classList.add(e),n}function l(t){if(t)for(;t.hasChildNodes();)t.removeChild(t.lastChild)}function u(t){return t.getBoundingClientRect()}function p(t,e){let n=[t.top,"px"].join(""),i=[t.left,"px"].join("");e.style.top=n,e.style.left=i}function f(){return[].slice.call(document.querySelectorAll(":hover")).pop()}var h=n(15),g=n.n(h),m=n(11),v=n.n(m),b=n(2);const x=n(0).remote.require("electron-settings");let C=b.b.tsek;const y=console.log;function E(t){let e=t.pars,n=o("#source"),i=o("#result");l(n),l(i),e.forEach(t=>{let e=function(t,e){let n=document.createElement("p");return n.textContent=t,e&&n.classList.add(e),n}();e.classList.add("tibpar"),t.forEach(t=>{let n=d(t.text);t.lang?n.classList.add("tibphrase"):t.punct?n.classList.add("punct"):n.classList.add("space"),e.appendChild(n)}),n.appendChild(e)});c("span.tibetan")}function L(t,e){let n=u(t),i=e?v()(t.textContent,!0):v()(t.textContent),s={top:n.top-40,left:n.left+15},r=o("#transcript");r.textContent=i,r.classList.remove("is-hidden"),p(s,r)}function S(t,e){let n;try{n=JSON.parse(t.dataset.chains)}catch(e){return void y("ERR: JSON chains",t)}let i=!t.closest(".tibpar"),s=function(t,e){let n;e?((n=a("div","popup")).classList.add("upper"),document.body.appendChild(n)):n=o("#ambi");let i=u(t);l(n),n.classList.remove("is-hidden"),p({top:i.bottom-3,left:i.left},n);let s=a("ul","ambilist");return n.appendChild(s),s}(t,i);e?function(t,e){e.forEach(e=>{let n,i=a("li","ambiline");t.appendChild(i),e.ambi?(n=d(e.seg,"tibambi")).dataset.chains=JSON.stringify(e.chains):e.docs.length?(n=d(e.seg,"tibwf")).dataset.docs=JSON.stringify(e.docs):n=d(e.seg,"tibphrase"),i.appendChild(n)})}(s,n):function(t,e){t.classList.add("danger"),e.forEach(e=>{let n=a("li","ambiline");t.appendChild(n),e.forEach(t=>{let e=t.docs.length?d(t.seg,"tibwf"):d(t.seg,"tibphrase");t.docs.length&&(e.dataset.docs=JSON.stringify(t.docs)),n.appendChild(e)})})}(s,n)}function R(t,e){o("#progress").classList.remove("is-hidden");let n=t.textContent.trim(),i=new RegExp(C+"$"),c={str:n.replace(i,""),compound:e,lastsek:s.a.last(n)==C};r.ipcRenderer.send("queryDBs",c)}r.ipcRenderer.on("replayDBs",function(t,e){o("#progress").classList.add("is-hidden");let n=e.chain,i=f();n&&(e.compound?(i.dataset.chains=JSON.stringify(n),S(i,!0)):function(t,e,n){t&&(t.textContent="",e.forEach((n,i)=>{let s;n.ambi?(s=d(n.seg,"tibambi")).dataset.chains=JSON.stringify(n.chains):n.docs.length?(s=d(n.seg,"tibwf")).dataset.docs=JSON.stringify(n.docs):s=d(n.seg,"tibphrase"),t.appendChild(s),i<e.length-1&&t.appendChild(d(C,"tsek"))}),n&&t.appendChild(d(C,"tsek")))}(i,n,e.lastsek))});const O=console.log,q=n(4);function w(t){let e=o("#cloneERR"),n=o("#progress");t?n.classList.add("is-hidden"):e.classList.remove("is-hidden")}function N(){let t=q.get("cfg");O("dicts: ACTIVE DICTS",t);t.map(t=>t.name);let e=o("#local-dicts-table tbody");l(e),t.forEach(t=>{let n=t.dname,i=a("tr");e.appendChild(i);let r=a("td","dictname");i.appendChild(r),r.textContent=s.a.capitalize(n),r.dataset.firstdict=n;let o=a("td","active-dict");if(t.active){let t=_();o.appendChild(t)}else o.textContent="activate";o.dataset.activedict=n,i.appendChild(o);let c=a("td","dictcsv");c.textContent="toCSV",c.dataset.csv=n,i.appendChild(c)})}function _(){let t=a("img","dict-check");return t.setAttribute("src","../resources/check.png"),t}r.ipcRenderer.on("remoteDictsReply",function(t,e){w(e),function(t){let e=q.get("cfg"),n=["_users"],i=e.map(t=>t.dname),r=s.a.uniq(n.concat(i)),c=o("#server-dicts-table tbody");l(c),t.forEach(t=>{if(n.includes(t))return;let e=a("tr");c.appendChild(e);let i=a("td");e.appendChild(i),i.textContent=s.a.capitalize(t);let o=a("td","link");if(r.includes(t)){let t=_();o.appendChild(t)}else o.textContent="sync";o.dataset.clone=t,e.appendChild(o)})}(e)}),r.ipcRenderer.on("replicateReply",function(t,e){w(e);U({section:"activedicts"})}),r.ipcRenderer.on("csvReply",function(t,e){w(e)});const j=n(3),k=(n(4),console.log),J=n(10);J.plugin(n(26));const D=r.remote.app,P=(D.getAppPath(),D.getPath("userData")),z=console.log,T=(n(12),n(0).remote.require("electron-settings")),A=n(27),{getCurrentWindow:K}=(n(3),n(13),n(0).remote);let M,B=[],I=0;function U(t){try{t=JSON.parse(JSON.stringify(t))}catch(e){z("NAV-state ERR",e),t={}}let e=t.section||"home";e||(t.section="home"),function(t){W(),o(["#",t].join("")).classList.remove("is-hidden")}(t.section),t.old||(t.old=!1,delete t.old,B.push(t),I=B.length-1),"main"==e?(function(t){let e=T.get("split-sizes")||[50,50];M&&t.mono?M.collapse(1):M&&M.setSizes(e),M||(T.set("split-sizes",e),M=g()(["#source","#result"],{sizes:e,gutterSize:5,cursor:"col-resize",minSize:[0,0],onDragEnd:function(t){T.set("split-sizes",t),K().reload()}}),t.mono&&M.collapse(1),document.addEventListener("keydown",function(t){},!1),document.addEventListener("wheel",function(t){},!1))}(t),E(t)):"clonedicts"==e?r.ipcRenderer.send("remoteDicts",""):"activedicts"==e&&N(),o("#progress").classList.add("is-hidden"),T.set("state",t)}function W(){const t=document.querySelectorAll(".section");Array.prototype.forEach.call(t,t=>{t.classList.add("is-hidden")}),o("#transcript").classList.add("is-hidden"),o("#ambi").classList.add("is-hidden")}A.bind(["alt+left","alt+right"],function(t){37==t.which?function(){if(I<=0)return;I--;let t=B[I];t.old=!0,W(),U(t)}():39==t.which&&function(){if(I>=B.length-1)return;I++;let t=B[I];t.old=!0,W(),U(t)}()}),A.bind(["alt+1","alt+2"],function(t){}),A.bind(["esc"],function(t){}),A.bind(["ctrl+d"],function(t){r.ipcRenderer.send("queryLocalDict","/home/michael/diglossa.texts/Tibetan")}),A.bind(["ctrl+u"],function(t){z("CLICK SIGNUP"),function(t){let e=new J("http://localhost:5984/mydb",{skip_setup:!0}),n=j.resolve(t,"pouch","auth");new J(n).sync(e,{live:!0,retry:!0}).on("error",console.log.bind(console)),e.signUp("batman","brucewayne",function(t,e){t&&("conflict"===t.name||t.name)}).then(function(t){k("SIGNUP RES",t)})}(P)});var V=n(5),F=n.n(V);n.d(e,"scrollPane",function(){return tt});const G=n(0).remote.require("electron-settings"),H=(n(28),n(29),n(13),console.log),Y=(n(3),n(12)),{dialog:$,getCurrentWindow:Q}=n(0).remote;n(9);o("#new-version");let X=o("#container");c('link[rel="import"]').forEach(t=>{let e=t.import.querySelector(".section");X.appendChild(e.cloneNode(!0))}),r.ipcRenderer.on("section",function(t,e){U({section:e})}),r.ipcRenderer.on("reread",function(t){let e=G.get("state");Q().reload(),U(e)});let Z=G.get("state");function tt(t,e){if(1==t.shiftKey)return;let n=t.deltaY>0?24:-24;o(".section.is-shown").scrollTop+=n}function et(t){H("FNS",t)}function nt(t){if(H("FNS",t),!t)return;let e=t[0];e&&r.ipcRenderer.send("importcsv",e)}Z||(Z={section:"home"}),U(Z),document.addEventListener("click",t=>{let e=o("#progress"),n=t.target.dataset;if(!n)return;let i=t.target.parentElement;if(t.target.classList.contains("external")){let e=t.target.textContent;r.shell.openExternal(e)}else n.section?U({section:n.section}):n.clone?(e.classList.remove("is-hidden"),r.ipcRenderer.send("replicate",n.clone)):n.firstdict?function(t){let e=q.get("cfg"),n=s.a.find(e,e=>e.dname==t),i=s.a.reject(e,e=>e.dname==t);i.unshift(n),(e=i).forEach((t,e)=>{t.idx=e}),q.set("cfg",e),N()}(n.firstdict):n.activedict?function(t){let e=q.get("cfg"),n=s.a.find(e,e=>e.dname==t.dataset.activedict),i=_();t.textContent?(t.textContent="",t.appendChild(i),n.active=!0):(l(t),t.textContent="activate",n.active=!1),q.set("cfg",e)}(t.target):n.csv?(e.classList.remove("is-hidden"),r.ipcRenderer.send("export-to-csv",n.csv)):i&&i.dataset&&i.dataset.activedict?H("activateDict(parent)_______"):"cleanupdb"==t.target.id?r.ipcRenderer.send("cleanupDB"):"scandir"==t.target.id?$.showOpenDialog({properties:["openDirectory"]},et):"importcsv"==t.target.id?$.showOpenDialog({properties:["openDir"],filters:[{name:"CSV",extensions:["csv"]}]},nt):n.docs&&R(t.target,!0)}),document.addEventListener("mouseover",function(t){if(!t.target.textContent)return;if(1==t.ctrlKey)return;t.target.closest(".tibpar")&&c(".popup").forEach(t=>{t.classList.add("is-hidden")}),t.target.classList.contains("tibphrase")?1==t.shiftKey||R(t.target):t.target.classList.contains("tibwf")?function(t){o("#source");let e=o("#result");l(e);let n=t.textContent,i=JSON.parse(t.dataset.docs);try{i=JSON.parse(t.dataset.docs)}catch(t){return void y("ERR: JSON docs",t)}let r=x.get("cfg"),c=JSON.parse(JSON.stringify(r));y("SHOW RESULTS: cfg",c),y("SHOW RESULTS: docs",i),i.forEach(t=>{t.weight=s.a.find(r,e=>t.dname==e.dname).idx}),i=s.a.sortBy(i,"weight");let d=a("div","dict");e.appendChild(d);let u=a("p","dict-wf");u.textContent=n,d.appendChild(u),i.forEach(t=>{let e=a("p","dict-dname");e.textContent=t.dname,d.appendChild(e);let n=a("p","dict-article");n.textContent=t.dict,d.appendChild(n);let i=a("ul","dict-ul");d.appendChild(i),t.trns||y("NO TRNS",t),t.trns&&t.trns.forEach(t=>{let e=a("li","dict-line");e.textContent=t,i.appendChild(e)})})}(t.target):t.target.classList.contains("tibambi")&&S(t.target)},!1),document.addEventListener("mouseleave",function(t){if(t.target.classList&&1!=t.ctrlKey&&t.target.classList.contains("tibphrase")){o("#transcript").classList.add("is-hidden")}},!1),document.addEventListener("keyup",function(t){if(1==t.ctrlKey)return;o("#transcript").classList.add("is-hidden")},!1),document.addEventListener("keydown",function(t){if(1!=t.shiftKey)return;let e=f();e&&("source"==e.id&&(e=o(".tibpar")),L(e),1==t.ctrlKey&&L(e,!0))},!1),document.addEventListener("wheel",function(t){tt(t,Z)},!1),Y.on("text-changed",()=>{let t=Y.readText(),e=F()(t,"tib");e&&e.length&&U({section:"main",pars:e})}).startWatching()}]);
//# sourceMappingURL=app.js.map