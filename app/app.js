!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=22)}([function(e,t){e.exports=require("electron")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("electron-settings")},,function(e,t){e.exports=require("fs-extra")},function(e,t){e.exports=require("electron-is-dev")},function(e,t){e.exports=require("pouchdb")},function(e,t){e.exports=require("electron-clipboard-extended")},function(e,t){e.exports=require("slash")},,function(e,t){e.exports=require("split.js")},function(e,t){e.exports=require("cholok")},,,,,function(e,t){e.exports=require("util")},function(e,t){e.exports=require("pouchdb-authentication")},function(e,t){e.exports=require("mousetrap")},function(e,t){e.exports=require("json5")},function(e,t){e.exports=require("axios")},function(e,t,n){"use strict";n.r(t);var i=n(1),s=n.n(i),o=n(0);n(17);function r(e){return document.querySelector(e)}function c(e){return document.querySelectorAll(e)}function l(e,t){let n=document.createElement(e);return t&&n.classList.add(t),n}function a(e,t){let n=document.createElement("span");return n.textContent=e,t&&n.classList.add(t),n}function d(e){if(e)for(;e.hasChildNodes();)e.removeChild(e.lastChild)}function u(e){return e.getBoundingClientRect()}function p(e,t){let n=[e.top,"px"].join(""),i=[e.left,"px"].join("");t.style.top=n,t.style.left=i}function f(){return[].slice.call(document.querySelectorAll(":hover")).pop()}var h=n(11),g=n.n(h),m=n(12),b=n.n(m);const x="་",C=["འི","ར","འོ","འམ","འི","ས","འང"];let y=x;const v=console.log;function E(e){if(!e||!e.pars||!e.pars.length)return;let t=e.pars,n=r("#source"),i=r("#result");d(n),d(i),t.forEach(e=>{let t=function(e,t){let n=document.createElement("p");return n.textContent=e,t&&n.classList.add(t),n}();t.classList.add("tibpar"),e.forEach(e=>{let n=a(e.text);e.tib&&n.classList.add("tibphrase"),e.punct&&n.classList.add("punct")," "==e.text&&n.classList.add("space"),t.appendChild(n)}),n.appendChild(t)});c("span.tibetan")}function L(e){let t=u(e),n=b()(e.textContent),i={top:t.top-40,left:t.left+15},s=r("#transcript");s.textContent=n,s.classList.remove("is-hidden"),p(i,s)}function S(e,t){let n;try{n=JSON.parse(e.dataset.chains)}catch(t){return void v("ERR: JSON chains",e)}let i=!e.closest(".tibpar"),s=function(e,t){let n;t?((n=l("div","popup")).classList.add("upper"),document.body.appendChild(n)):n=r("#ambi");let i=u(e);d(n),n.classList.remove("is-hidden"),p({top:i.bottom-3,left:i.left},n);let s=l("ul","ambilist");return n.appendChild(s),s}(e,i);t?function(e,t){t.forEach(t=>{let n,i=l("li","ambiline");e.appendChild(i),t.ambi?(n=a(t.seg,"tibambi")).dataset.chains=JSON.stringify(t.chains):t.docs.length?(n=a(t.seg,"tibwf")).dataset.docs=JSON.stringify(t.docs):n=a(t.seg,"tibphrase"),i.appendChild(n)})}(s,n):function(e,t){e.classList.add("danger"),t.forEach(t=>{let n=l("li","ambiline");e.appendChild(n),t.forEach(e=>{let t=e.docs.length?a(e.seg,"tibwf"):a(e.seg,"tibphrase");e.docs.length&&(t.dataset.docs=JSON.stringify(e.docs)),n.appendChild(t)})})}(s,n),r("#progress").classList.remove("is-shown")}const w=console.log,q=n(3);function R(){let e=q.get("cfg").map(e=>e.name),t=r("#local-dicts-table tbody");d(t),e.forEach(e=>{let n=l("tr");t.appendChild(n);let i=l("td","dictname");n.appendChild(i),i.textContent=s.a.capitalize(e),i.dataset.activedict=e;let o=l("td","active-dict");o.textContent="activate",o.dataset.active=e,n.appendChild(o)})}o.ipcRenderer.on("remoteDictsReply",function(e,t){!function(e){let t=q.get("cfg"),n=t.map(e=>e.name),i=s.a.uniq(["terms","verbs","lobsang","_users"].concat(n)),o=s.a.difference(e,i),a=r("#server-dicts-table tbody");o.forEach(e=>{let t=c("#server-dicts-table tr td"),n=s.a.map(t,e=>e.textContent);if(n.includes(s.a.capitalize(e)))return;let i=l("tr");a.appendChild(i);let o=l("td");i.appendChild(o),o.textContent=s.a.capitalize(e);let r=l("td","link");r.textContent="sync",r.dataset.clone=e,i.appendChild(r)})}(t)}),o.ipcRenderer.on("replicateReply",function(e,t){w("____________ replicateReply",t);T({section:"activedicts"})});const O=n(2),N=(n(3),console.log),_=n(7);_.plugin(n(18));const j=o.remote.app,J=(j.getAppPath(),j.getPath("userData")),k=console.log,D=(n(8),n(0).remote.require("electron-settings")),z=n(19),{getCurrentWindow:P}=(n(5),n(2),n(9),n(0).remote);let K,A=[],I=0;function T(e){try{e=JSON.parse(JSON.stringify(e))}catch(t){k("NAV-state ERR",t),e={}}let t=e.section||"home";t||(e.section="home"),function(e){!function(){const e=document.querySelectorAll(".section.is-shown");Array.prototype.forEach.call(e,e=>{e.classList.remove("is-shown")}),r("#transcript").classList.add("is-hidden"),r("#ambi").classList.add("is-hidden")}();const t=["#",e].join("");k("SEC ID",t),r(t).classList.add("is-shown")}(e.section),e.old||(e.old=!1,delete e.old,A.push(e),I=A.length-1);let n=r("#progress");"main"==t?(function(e){let t=D.get("split-sizes")||[50,50];K&&e.mono?K.collapse(1):K&&K.setSizes(t),K||(D.set("split-sizes",t),K=g()(["#source","#result"],{sizes:t,gutterSize:5,cursor:"col-resize",minSize:[0,0],onDragEnd:function(e){D.set("split-sizes",e),P().reload()}}),e.mono&&K.collapse(1),document.addEventListener("keydown",function(e){},!1),document.addEventListener("wheel",function(e){},!1))}(e),E(e)):"clone"==t?o.ipcRenderer.send("remoteDicts",""):"activedicts"==t?R():n.classList.remove("is-shown"),D.set("state",e)}z.bind(["alt+left","alt+right"],function(e){37==e.which?function(){if(I<=0)return;I--;let e=A[I];e.old=!0,T(e)}():39==e.which&&function(){if(I>=A.length-1)return;I++;let e=A[I];e.old=!0,T(e)}()}),z.bind(["alt+1","alt+2"],function(e){}),z.bind(["esc"],function(e){}),z.bind(["ctrl+i"],function(e){k("CLICK INFO")}),z.bind(["ctrl+u"],function(e){k("CLICK SIGNUP"),function(e){let t=new _("http://localhost:5984/mydb",{skip_setup:!0}),n=O.resolve(e,"pouch","auth");new _(n).sync(t,{live:!0,retry:!0}).on("error",console.log.bind(console)),t.signUp("batman","brucewayne",function(e,t){e&&("conflict"===e.name||e.name)}).then(function(e){N("SIGNUP RES",e)})}(J)}),z.bind(["ctrl+p"],function(e){k("ZERO CFG"),D.set("cfg","")}),z.bind(["ctrl+d"],function(e){k("DDD"),T({section:"activedicts"})});console.log;let B={zho:"([一-鿿]+)",tib:"([ༀ-࿿]+)",grc:"([Ͱ-Ͽἀ-῿̀-ͯ']+)"};console.log;const M=x;let U=x;console.log;function F(e,t){r("#progress").classList.add("is-shown");let n,i=e.textContent.trim(),c=new RegExp(U+"$"),l=i.replace(c,""),a=s.a.last(i)==U,d=function(e){let t=e.split(M),n=t.length<10?10:2,i=e,o=(t.length,[[t]]);!function e(t,r){(function(e){let t,n,i=[];for(let s=1;s<e.length+1;s++){t=e.slice(0,s),n=e.slice(s);let o={head:t,tail:n};n.length&&i.push(o)}return i.reverse()})(t).forEach(t=>{r.push(t.head),r.push(t.tail),s.a.flatten(r).join(M)==i&&(o.push(s.a.clone(r)),r.pop()),r.length<n&&e(t.tail,r),r.pop()})}(t,[]);let r=[];return o.forEach(e=>{let t=[];e.forEach(e=>{t.push(e.join(M))}),r.push(t)}),r}(l),u=function(e){let t=s.a.uniq(s.a.flatten(e)),n=[];return t.forEach(e=>{C.forEach(t=>{let i=new RegExp(t+"$"),s=e.replace(i,"");e!=s&&n.push(s)})}),{main:t,added:n}}(d),p={keys:n=t?s.a.filter(u.main,e=>e!=l):s.a.uniq(u.main.concat(u.added)),pdchs:d,compound:t,lastsek:a};o.ipcRenderer.send("queryDBs",p)}function G(e){let t=s.a.max(e.map(e=>s.a.sum(e.map(e=>e.docs.length?e.seg.length:0))/e.length)),n=s.a.filter(e,e=>s.a.sum(e.map(e=>e.docs.length?e.seg.length:0))/e.length>=t-1),i=s.a.min(n.map(e=>e.length));return s.a.filter(n,e=>e.length==i)}o.ipcRenderer.on("replayDBs",function(e,t){!function(e){let t,n=f(),i=s.a.flatten(e.docs),o=function(e,t){let n,i,o=[],r=[];e.forEach(e=>{let n=[],i=!1,c=!0;e.forEach(e=>{let o=s.a.filter(t,t=>(function(e,t){if(e==t)return!0;let n=new RegExp("^"+t),i=e.replace(n,"");return!(e==i||!C.includes(i))})(e,t.dict));o.length&&(i=!0),o.length||(c=!1);let r={seg:e,docs:o};n.push(r)}),i&&o.push(n),c&&r.push(n)}),r.length?(n=G(r),i=!0):n=G(o);return{chains:n,full:i}}(e.pdchs,i).chains;if(o.length>1)t=function(e){let t,n=e[0],i=[];for(let o=0;o<n.length;o++){let r=e.map(e=>e[o].seg);if(1==s.a.uniq(r).length)i.push(n[o]),t=null;else{t||(t={ambi:!0,seg:"",docs:[]},i.push(t));let n=e.map(e=>({seg:e[o].seg,docs:e[o].docs}));t.docs.push(n)}}return s.a.filter(i,e=>e.ambi).forEach(e=>{let t=e.docs[0],n=[];for(let i=0;i<t.length;i++){let t=e.docs.map(e=>e[i]);n.push(t)}e.chains=n;let i=n[0];e.seg=i.map(e=>e.seg).join(U)}),i}(o);else{if(1!=o.length)return v("NO RESULT"),void r("#progress").classList.remove("is-shown");t=o[0]}e.compound?(n.dataset.chains=JSON.stringify(t),S(n,!0)):function(e,t,n){e.textContent="",t.forEach((n,i)=>{let s;n.ambi?(s=a(n.seg,"tibambi")).dataset.chains=JSON.stringify(n.chains):n.docs.length?(s=a(n.seg,"tibwf")).dataset.docs=JSON.stringify(n.docs):s=a(n.seg,"tibphrase"),e.appendChild(s),i<t.length-1&&e.appendChild(a(y,"tsek"))}),n&&e.appendChild(a(y,"tsek")),r("#progress").classList.remove("is-shown")}(n,t,e.lastsek)}(t)});const W=n(0).remote.require("electron-settings"),V=(n(20),n(21),n(9),console.log,n(2),n(8)),{dialog:$,getCurrentWindow:Z}=n(0).remote;n(6);r("#new-version");let H=r("#container");c('link[rel="import"]').forEach(e=>{let t=e.import.querySelector(".section");H.appendChild(t.cloneNode(!0))}),o.ipcRenderer.on("section",function(e,t){T({section:t})}),o.ipcRenderer.on("action",function(e,t){"clonedicts"==t?T({section:"clone"}):"arrangeDicts"==t?T({section:"activedicts"}):"csv"==t?$.showOpenDialog({properties:["openFile"],filters:[{name:"JSON",extensions:["stardict"]}]},parseCSV):"cleanupdb"==t&&cleanupDB()}),o.ipcRenderer.on("reread",function(e){let t=W.get("state");Z().reload(),T(t)});let Q=W.get("state");Q||(Q={section:"home"}),T(Q),document.addEventListener("click",e=>{let t=e.target.dataset;if(t)if(t.external){let t=e.target.textContent;o.shell.openExternal(t)}else if(t.section)T({section:t.section});else if(t.clone)o.ipcRenderer.send("replicate",t.clone);else if(t.activedict){!function(e){let t=q.get("cfg"),n=s.a.find(t,t=>t.name==e),i=s.a.reject(t,t=>t.name==e);i.unshift(n),(t=i).forEach((e,t)=>{e.idx=t}),q.set("cfg",t),R()}(t.activedict)}else t.docs&&F(e.target,!0)}),document.addEventListener("mouseover",function(e){if(!e.target.textContent)return;if(1==e.ctrlKey)return;e.target.closest(".tibpar")&&c(".popup").forEach(e=>{e.classList.add("is-hidden")}),e.target.classList.contains("tibphrase")?1==e.shiftKey?L(e.target):F(e.target):e.target.classList.contains("tibwf")?function(e){r("#source");let t=r("#result");d(t);let n=e.textContent,i=JSON.parse(e.dataset.docs);try{i=JSON.parse(e.dataset.docs)}catch(e){return void v("ERR: JSON docs")}let s=l("div","dict");t.appendChild(s);let o=l("p","dict-wf");o.textContent=n,s.appendChild(o),i.forEach(e=>{let t=l("p","dict-dname");t.textContent=e.dname,s.appendChild(t);let n=l("p","dict-article");n.textContent=e.dict,s.appendChild(n);let i=l("ul","dict-ul");s.appendChild(i),e.trns||v("NO TRNS",e),e.trns&&e.trns.forEach(e=>{let t=l("li","dict-line");t.textContent=e,i.appendChild(t)})})}(e.target):e.target.classList.contains("tibambi")&&S(e.target)},!1),document.addEventListener("mouseleave",function(e){if(e.target.classList&&1!=e.ctrlKey&&e.target.classList.contains("tibphrase")){r("#transcript").classList.add("is-hidden")}},!1),document.addEventListener("keyup",function(e){if(1==e.ctrlKey)return;r("#transcript").classList.add("is-hidden")},!1),document.addEventListener("keydown",function(e){if(1==e.ctrlKey)return;if(1!=e.shiftKey)return;let t=f();"source"==t.id&&(t=r(".tibpar")),L(t)},!1),V.on("text-changed",()=>{let e=((e,t)=>{let n=new RegExp(B[e]);if(!n.test(t))return;let i=t.trim().replace(/᾽/g,"'"),o=i.split("'").join("");if(!n.test(o))return;let r=new RegExp("([.,!:;·།])"),c=i.replace(/\r?\n+/,"\n").split("\n"),l=(c.map(e=>e.split(r)),[]);return c.forEach(t=>{let i=[];t.split(r).forEach(t=>{if(r.test(t)){let e={text:t,punct:!0};i.push(e)}else{let o=t.split(n);(o=s.a.compact(o)).forEach(t=>{let s={text:t};!!n.test(t)&&(s[e]=!0),i.push(s)})}}),l.push(i)}),l})("tib",V.readText());e&&e.length&&T({section:"main",pars:e})}).startWatching()}]);
//# sourceMappingURL=app.js.map