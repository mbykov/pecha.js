!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=22)}([function(t,e){t.exports=require("electron")},function(t,e){t.exports=require("lodash")},function(t,e){t.exports=require("path")},function(t,e){t.exports=require("electron-settings")},,function(t,e){t.exports=require("fs-extra")},function(t,e){t.exports=require("electron-is-dev")},function(t,e){t.exports=require("pouchdb")},function(t,e){t.exports=require("electron-clipboard-extended")},function(t,e){t.exports=require("slash")},,function(t,e){t.exports=require("split.js")},function(t,e){t.exports=require("cholok")},,,,,function(t,e){t.exports=require("util")},function(t,e){t.exports=require("pouchdb-authentication")},function(t,e){t.exports=require("mousetrap")},function(t,e){t.exports=require("json5")},function(t,e){t.exports=require("axios")},function(t,e,n){"use strict";n.r(e);var i=n(1),s=n.n(i),o=n(0);n(17);function r(t){return document.querySelector(t)}function c(t){return document.querySelectorAll(t)}function a(t,e){let n=document.createElement(t);return e&&n.classList.add(e),n}function l(t,e){let n=document.createElement("span");return n.textContent=t,e&&n.classList.add(e),n}function d(t){if(t)for(;t.hasChildNodes();)t.removeChild(t.lastChild)}function u(t){return t.getBoundingClientRect()}function p(t,e){let n=[t.top,"px"].join(""),i=[t.left,"px"].join("");e.style.top=n,e.style.left=i}function f(){return[].slice.call(document.querySelectorAll(":hover")).pop()}var h=n(11),g=n.n(h),m=n(12),b=n.n(m);const C="་",x=["འི","ར","འོ","འམ","འི","ས","འང"];let v=C;const y=console.log;function E(t){if(!t||!t.pars||!t.pars.length)return;let e=t.pars,n=r("#source"),i=r("#result");d(n),d(i),e.forEach(t=>{let e=function(t,e){let n=document.createElement("p");return n.textContent=t,e&&n.classList.add(e),n}();e.classList.add("tibpar"),t.forEach(t=>{let n=l(t.text);t.tib&&n.classList.add("tibphrase"),t.punct&&n.classList.add("punct")," "==t.text&&n.classList.add("space"),e.appendChild(n)}),n.appendChild(e)});c("span.tibetan")}function L(t){let e=u(t),n=b()(t.textContent),i={top:e.top-40,left:e.left+15},s=r("#transcript");s.textContent=n,s.classList.remove("is-hidden"),p(i,s)}function S(t,e){let n;try{n=JSON.parse(t.dataset.chains)}catch(e){return void y("ERR: JSON chains",t)}let i=!t.closest(".tibpar"),s=function(t,e){let n;e?((n=a("div","popup")).classList.add("upper"),document.body.appendChild(n)):n=r("#ambi");let i=u(t);d(n),n.classList.remove("is-hidden"),p({top:i.bottom-3,left:i.left},n);let s=a("ul","ambilist");return n.appendChild(s),s}(t,i);e?function(t,e){e.forEach(e=>{let n,i=a("li","ambiline");t.appendChild(i),e.ambi?(n=l(e.seg,"tibambi")).dataset.chains=JSON.stringify(e.chains):e.docs.length?(n=l(e.seg,"tibwf")).dataset.docs=JSON.stringify(e.docs):n=l(e.seg,"tibphrase"),i.appendChild(n)})}(s,n):function(t,e){t.classList.add("danger"),e.forEach(e=>{let n=a("li","ambiline");t.appendChild(n),e.forEach(t=>{let e=t.docs.length?l(t.seg,"tibwf"):l(t.seg,"tibphrase");t.docs.length&&(e.dataset.docs=JSON.stringify(t.docs)),n.appendChild(e)})})}(s,n),r("#progress").classList.remove("is-shown")}const w=console.log,R=n(3);function q(){let t=R.get("cfg"),e=(t.map(t=>t.name),r("#local-dicts-table tbody"));d(e),t.forEach(t=>{let n=t.name,i=a("tr");e.appendChild(i);let o=a("td","dictname");i.appendChild(o),o.textContent=s.a.capitalize(n),o.dataset.firstdict=n;let r=a("td","active-dict");if(t.active){let t=N();r.appendChild(t)}else r.textContent="activate";r.dataset.activedict=n,i.appendChild(r)})}function O(t){let e=R.get("cfg"),n=s.a.find(e,e=>e.name==t.dataset.activedict),i=N();t.textContent?(t.textContent="",t.appendChild(i),n.active=!0):(d(t),t.textContent="activate",n.active=!1),R.set("cfg",e)}function N(){let t=a("img","dict-check");return t.setAttribute("src","../resources/check.png"),t}o.ipcRenderer.on("remoteDictsReply",function(t,e){!function(t){let e=R.get("cfg"),n=e.map(t=>t.name),i=s.a.uniq(["terms","verbs","lobsang","_users"].concat(n)),o=s.a.difference(t,i),l=r("#server-dicts-table tbody");o.forEach(t=>{let e=c("#server-dicts-table tr td"),n=s.a.map(e,t=>t.textContent);if(n.includes(s.a.capitalize(t)))return;let i=a("tr");l.appendChild(i);let o=a("td");i.appendChild(o),o.textContent=s.a.capitalize(t);let r=a("td","link");r.textContent="sync",r.dataset.clone=t,i.appendChild(r)})}(e)}),o.ipcRenderer.on("replicateReply",function(t,e){w("____________ replicateReply",e);M({section:"activedicts"})});const _=n(2),j=(n(3),console.log),k=n(7);k.plugin(n(18));const J=o.remote.app,D=(J.getAppPath(),J.getPath("userData")),z=console.log,K=(n(8),n(0).remote.require("electron-settings")),P=n(19),{getCurrentWindow:A}=(n(5),n(2),n(9),n(0).remote);let I,T=[],B=0;function M(t){try{t=JSON.parse(JSON.stringify(t))}catch(e){z("NAV-state ERR",e),t={}}let e=t.section||"home";e||(t.section="home"),function(t){!function(){const t=document.querySelectorAll(".section.is-shown");Array.prototype.forEach.call(t,t=>{t.classList.remove("is-shown")}),r("#transcript").classList.add("is-hidden"),r("#ambi").classList.add("is-hidden")}();const e=["#",t].join("");z("SEC ID",e),r(e).classList.add("is-shown")}(t.section),t.old||(t.old=!1,delete t.old,T.push(t),B=T.length-1);let n=r("#progress");"main"==e?(function(t){let e=K.get("split-sizes")||[50,50];I&&t.mono?I.collapse(1):I&&I.setSizes(e),I||(K.set("split-sizes",e),I=g()(["#source","#result"],{sizes:e,gutterSize:5,cursor:"col-resize",minSize:[0,0],onDragEnd:function(t){K.set("split-sizes",t),A().reload()}}),t.mono&&I.collapse(1),document.addEventListener("keydown",function(t){},!1),document.addEventListener("wheel",function(t){},!1))}(t),E(t)):"clone"==e?o.ipcRenderer.send("remoteDicts",""):"activedicts"==e?q():n.classList.remove("is-shown"),K.set("state",t)}P.bind(["alt+left","alt+right"],function(t){37==t.which?function(){if(B<=0)return;B--;let t=T[B];t.old=!0,M(t)}():39==t.which&&function(){if(B>=T.length-1)return;B++;let t=T[B];t.old=!0,M(t)}()}),P.bind(["alt+1","alt+2"],function(t){}),P.bind(["esc"],function(t){}),P.bind(["ctrl+i"],function(t){z("CLICK INFO")}),P.bind(["ctrl+u"],function(t){z("CLICK SIGNUP"),function(t){let e=new k("http://localhost:5984/mydb",{skip_setup:!0}),n=_.resolve(t,"pouch","auth");new k(n).sync(e,{live:!0,retry:!0}).on("error",console.log.bind(console)),e.signUp("batman","brucewayne",function(t,e){t&&("conflict"===t.name||t.name)}).then(function(t){j("SIGNUP RES",t)})}(D)}),P.bind(["ctrl+p"],function(t){z("ZERO CFG"),K.set("cfg","")}),P.bind(["ctrl+d"],function(t){z("DDD"),M({section:"activedicts"})});console.log;let U={zho:"([一-鿿]+)",tib:"([ༀ-࿿]+)",grc:"([Ͱ-Ͽἀ-῿̀-ͯ']+)"};console.log;const F=C;let G=C;console.log;function V(t,e){r("#progress").classList.add("is-shown");let n,i=t.textContent.trim(),c=new RegExp(G+"$"),a=i.replace(c,""),l=s.a.last(i)==G,d=function(t){let e=t.split(F),n=e.length<10?10:2,i=t,o=(e.length,[[e]]);!function t(e,r){(function(t){let e,n,i=[];for(let s=1;s<t.length+1;s++){e=t.slice(0,s),n=t.slice(s);let o={head:e,tail:n};n.length&&i.push(o)}return i.reverse()})(e).forEach(e=>{r.push(e.head),r.push(e.tail),s.a.flatten(r).join(F)==i&&(o.push(s.a.clone(r)),r.pop()),r.length<n&&t(e.tail,r),r.pop()})}(e,[]);let r=[];return o.forEach(t=>{let e=[];t.forEach(t=>{e.push(t.join(F))}),r.push(e)}),r}(a),u=function(t){let e=s.a.uniq(s.a.flatten(t)),n=[];return e.forEach(t=>{x.forEach(e=>{let i=new RegExp(e+"$"),s=t.replace(i,"");t!=s&&n.push(s)})}),{main:e,added:n}}(d),p={keys:n=e?s.a.filter(u.main,t=>t!=a):s.a.uniq(u.main.concat(u.added)),pdchs:d,compound:e,lastsek:l};o.ipcRenderer.send("queryDBs",p)}function W(t){let e=s.a.max(t.map(t=>s.a.sum(t.map(t=>t.docs.length?t.seg.length:0))/t.length)),n=s.a.filter(t,t=>s.a.sum(t.map(t=>t.docs.length?t.seg.length:0))/t.length>=e-1),i=s.a.min(n.map(t=>t.length));return s.a.filter(n,t=>t.length==i)}o.ipcRenderer.on("replayDBs",function(t,e){!function(t){let e,n=f(),i=s.a.flatten(t.docs),o=function(t,e){let n,i,o=[],r=[];t.forEach(t=>{let n=[],i=!1,c=!0;t.forEach(t=>{let o=s.a.filter(e,e=>(function(t,e){if(t==e)return!0;let n=new RegExp("^"+e),i=t.replace(n,"");return!(t==i||!x.includes(i))})(t,e.dict));o.length&&(i=!0),o.length||(c=!1);let r={seg:t,docs:o};n.push(r)}),i&&o.push(n),c&&r.push(n)}),r.length?(n=W(r),i=!0):n=W(o);return{chains:n,full:i}}(t.pdchs,i).chains;if(o.length>1)e=function(t){let e,n=t[0],i=[];for(let o=0;o<n.length;o++){let r=t.map(t=>t[o].seg);if(1==s.a.uniq(r).length)i.push(n[o]),e=null;else{e||(e={ambi:!0,seg:"",docs:[]},i.push(e));let n=t.map(t=>({seg:t[o].seg,docs:t[o].docs}));e.docs.push(n)}}return s.a.filter(i,t=>t.ambi).forEach(t=>{let e=t.docs[0],n=[];for(let i=0;i<e.length;i++){let e=t.docs.map(t=>t[i]);n.push(e)}t.chains=n;let i=n[0];t.seg=i.map(t=>t.seg).join(G)}),i}(o);else{if(1!=o.length)return y("NO RESULT"),void r("#progress").classList.remove("is-shown");e=o[0]}t.compound?(n.dataset.chains=JSON.stringify(e),S(n,!0)):function(t,e,n){t.textContent="",e.forEach((n,i)=>{let s;n.ambi?(s=l(n.seg,"tibambi")).dataset.chains=JSON.stringify(n.chains):n.docs.length?(s=l(n.seg,"tibwf")).dataset.docs=JSON.stringify(n.docs):s=l(n.seg,"tibphrase"),t.appendChild(s),i<e.length-1&&t.appendChild(l(v,"tsek"))}),n&&t.appendChild(l(v,"tsek")),r("#progress").classList.remove("is-shown")}(n,e,t.lastsek)}(e)});const $=n(0).remote.require("electron-settings"),Z=(n(20),n(21),n(9),console.log),H=(n(2),n(8)),{dialog:Q,getCurrentWindow:X}=n(0).remote;n(6);r("#new-version");let Y=r("#container");c('link[rel="import"]').forEach(t=>{let e=t.import.querySelector(".section");Y.appendChild(e.cloneNode(!0))}),o.ipcRenderer.on("section",function(t,e){M({section:e})}),o.ipcRenderer.on("action",function(t,e){"clonedicts"==e?M({section:"clone"}):"arrangeDicts"==e?M({section:"activedicts"}):"csv"==e?Q.showOpenDialog({properties:["openFile"],filters:[{name:"JSON",extensions:["stardict"]}]},parseCSV):"cleanupdb"==e&&cleanupDB()}),o.ipcRenderer.on("reread",function(t){let e=$.get("state");X().reload(),M(e)});let tt=$.get("state");tt||(tt={section:"home"}),M(tt),document.addEventListener("click",t=>{let e=t.target.dataset;if(!e)return;let n=t.target.parentElement;if(e.external){let e=t.target.textContent;o.shell.openExternal(e)}else e.section?M({section:e.section}):e.clone?o.ipcRenderer.send("replicate",e.clone):e.firstdict?function(t){let e=R.get("cfg"),n=s.a.find(e,e=>e.name==t),i=s.a.reject(e,e=>e.name==t);i.unshift(n),(e=i).forEach((t,e)=>{t.idx=e}),R.set("cfg",e),q()}(e.firstdict):e.activedict?(Z("CKLICK ACTIVE"),O(t.target)):n.dataset.activedict?(Z("CKLICK PARENT"),O(n)):e.docs&&V(t.target,!0)}),document.addEventListener("mouseover",function(t){if(!t.target.textContent)return;if(1==t.ctrlKey)return;t.target.closest(".tibpar")&&c(".popup").forEach(t=>{t.classList.add("is-hidden")}),t.target.classList.contains("tibphrase")?1==t.shiftKey?L(t.target):V(t.target):t.target.classList.contains("tibwf")?function(t){r("#source");let e=r("#result");d(e);let n=t.textContent,i=JSON.parse(t.dataset.docs);try{i=JSON.parse(t.dataset.docs)}catch(t){return void y("ERR: JSON docs")}let s=a("div","dict");e.appendChild(s);let o=a("p","dict-wf");o.textContent=n,s.appendChild(o),i.forEach(t=>{let e=a("p","dict-dname");e.textContent=t.dname,s.appendChild(e);let n=a("p","dict-article");n.textContent=t.dict,s.appendChild(n);let i=a("ul","dict-ul");s.appendChild(i),t.trns||y("NO TRNS",t),t.trns&&t.trns.forEach(t=>{let e=a("li","dict-line");e.textContent=t,i.appendChild(e)})})}(t.target):t.target.classList.contains("tibambi")&&S(t.target)},!1),document.addEventListener("mouseleave",function(t){if(t.target.classList&&1!=t.ctrlKey&&t.target.classList.contains("tibphrase")){r("#transcript").classList.add("is-hidden")}},!1),document.addEventListener("keyup",function(t){if(1==t.ctrlKey)return;r("#transcript").classList.add("is-hidden")},!1),document.addEventListener("keydown",function(t){if(1==t.ctrlKey)return;if(1!=t.shiftKey)return;let e=f();"source"==e.id&&(e=r(".tibpar")),L(e)},!1),H.on("text-changed",()=>{let t=((t,e)=>{let n=new RegExp(U[t]);if(!n.test(e))return;let i=e.trim().replace(/᾽/g,"'"),o=i.split("'").join("");if(!n.test(o))return;let r=new RegExp("([.,!:;·།])"),c=i.replace(/\r?\n+/,"\n").split("\n"),a=(c.map(t=>t.split(r)),[]);return c.forEach(e=>{let i=[];e.split(r).forEach(e=>{if(r.test(e)){let t={text:e,punct:!0};i.push(t)}else{let o=e.split(n);(o=s.a.compact(o)).forEach(e=>{let s={text:e};!!n.test(e)&&(s[t]=!0),i.push(s)})}}),a.push(i)}),a})("tib",H.readText());t&&t.length&&M({section:"main",pars:t})}).startWatching()}]);
//# sourceMappingURL=app.js.map