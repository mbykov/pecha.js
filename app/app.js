!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=19)}([function(e,t){e.exports=require("electron")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("path")},,function(e,t){e.exports=require("fs-extra")},function(e,t){e.exports=require("electron-clipboard-extended")},function(e,t){e.exports=require("slash")},,function(e,t){e.exports=require("split.js")},function(e,t){e.exports=require("cholok")},,,,function(e,t){e.exports=require("util")},function(e,t){e.exports=require("pouchdb")},function(e,t){e.exports=require("mousetrap")},function(e,t){e.exports=require("json5")},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("electron-is-dev")},function(e,t,n){"use strict";n.r(t);var o=n(1),r=n.n(o),s=n(0);n(13);function i(e){return document.querySelector(e)}function l(e){return document.querySelectorAll(e)}function c(e,t){let n=document.createElement("span");return n.textContent=e,t&&n.classList.add(t),n}function a(e){if(e)for(;e.hasChildNodes();)e.removeChild(e.lastChild)}function u(e){return e.getBoundingClientRect()}function p(e,t){let n=[e.top,"px"].join(""),o=[e.left,"px"].join("");t.style.top=n,t.style.left=o}var f=n(8),d=n.n(f),h=n(9),g=n.n(h);const m="་",x=["འི","ར","འོ","འམ","འི","ས","འང"];const E=console.log;function b(e){if(!e||!e.pars||!e.pars.length)return;let t=e.pars,n=i("#source"),o=i("#result");a(n),a(o),t.forEach(e=>{let t=function(e,t){let n=document.createElement("p");return n.textContent=e,t&&n.classList.add(t),n}();t.classList.add("tibpar"),e.forEach(e=>{let n=c(e.text);e.tib&&n.classList.add("tibphrase"),e.punct&&n.classList.add("punct")," "==e.text&&n.classList.add("space"),t.appendChild(n)}),n.appendChild(t)});l("span.tibetan")}function v(e){i("#source");let t=i("#result");a(t);let n=e.textContent;t.textContent=n}function L(e){E("NO RESULT",e.textContent),a(i("#result")),i("#progress").classList.remove("is-shown")}const w=n(2);let y=n(4);const C=s.remote.app,S=(C.getAppPath(),C.getPath("userData")),q=s.remote.require("electron-settings"),O=console.log,R=n(14);let j=[],N=w.resolve(S,"pouch");function A(e){return j.length||_(),function(e){return Promise.all(j.map(function(t){return t.allDocs({keys:e,include_docs:!0}).then(function(e){if(!e||!e.rows)throw new Error("no dbn result");let n=r.a.compact(e.rows.map(e=>e.doc)),o=r.a.flatten(r.a.compact(n.map(e=>e.docs)));return o.length?(o.forEach(e=>{e.dname=t.dname,e.weight=t.weight}),o):[]}).catch(function(e){console.log("ERR GET DBs",e)})}))}(e)}function _(){let e=q.get("cfg");O("===setDBs CFG===",e),r.a.compact(e.map(e=>e.active?e.name:null)).forEach((e,t)=>{let n=w.resolve(S,"pouch",e),o=new R(n);o.dname=e,o.weight=t,j.push(o)})}y.ensureDirSync(N);const D=console.log,P=(n(5),n(0).remote.require("electron-settings")),z=n(15),{getCurrentWindow:M}=(n(4),n(2),n(6),n(0).remote);let T,k=[],F=0;function I(e){!function(){const e=document.querySelectorAll(".section.is-shown");Array.prototype.forEach.call(e,e=>{e.classList.remove("is-shown")}),i("#transcript").classList.add("is-hidden"),i("#ambi").classList.add("is-hidden")}(),i(["#",e].join("")).classList.add("is-shown")}function G(e){try{e=JSON.parse(JSON.stringify(e))}catch(t){D("NAV-state ERR",t),e={}}let t=e.section||"home";t||(e.section="home"),I(e.section),e.old||(e.old=!1,delete e.old,k.push(e),F=k.length-1);let n=i("#progress");"main"==t?(function(e){let t=P.get("split-sizes")||[50,50];T&&e.mono?T.collapse(1):T&&T.setSizes(t),T||(P.set("split-sizes",t),T=d()(["#source","#result"],{sizes:t,gutterSize:5,cursor:"col-resize",minSize:[0,0],onDragEnd:function(e){P.set("split-sizes",e),M().reload()}}),e.mono&&T.collapse(1),document.addEventListener("keydown",function(e){},!1),document.addEventListener("wheel",function(e){},!1))}(e),b(e)):n.classList.remove("is-shown"),e={section:"home"},P.set("state",e)}z.bind(["alt+left","alt+right"],function(e){37==e.which?function(){if(F<=0)return;F--;let e=k[F];e.old=!0,G(e)}():39==e.which&&function(){if(F>=k.length-1)return;F++;let e=k[F];e.old=!0,G(e)}()}),z.bind(["alt+1","alt+2"],function(e){}),z.bind(["esc"],function(e){}),z.bind(["ctrl+k"],function(e){D("CLICK CLONE"),function(){j.length||_();let e=r.a.find(j,e=>"vasilyev"==e.dname);O("DB-name",e.dname);let t=new R("http://localhost:5984/vasilyev");e.replicate.to(t).on("complete",function(){O("yay, were done!")}).on("error",function(e){O("boo, something went wrong!",e)})}()}),z.bind(["ctrl+p"],function(e){D("ZERO CFG"),P.set("cfg","")});console.log;let B={zho:"([一-鿿]+)",tib:"([ༀ-࿿]+)",grc:"([Ͱ-Ͽἀ-῿̀-ͯ']+)"};console.log;const J=m;function U(e){let t,n,o=[];for(let r=1;r<e.length+1;r++){let s={head:t=e.slice(0,r),tail:n=e.slice(r)};n.length&&o.push(s)}return o.reverse()}let V=m;const W=console.log;function Z(e){i("#progress");let t=new RegExp(V+"$"),n=e.textContent.trim().replace(t,""),o=n.split(V),s=!1;e.parentNode.classList.contains("tibphrase")&&(s=!0);let l=function(e,t){let n=e.split(J),o=e,s=(n.length,[[n]]);!function e(t,n){U(t).forEach(t=>{n.push(t.head),n.push(t.tail),r.a.flatten(n).join(J)==o&&(s.push(r.a.clone(n)),n.pop()),n.length<2&&e(t.tail,n),n.pop()})}(n,[]);let i=[];return s.forEach(e=>{let t=[];e.forEach(e=>{t.push(e.join(J))}),i.push(t)}),i}(n);W("MAIN pdchs:",o.length,"=>",l.length),W("MAIN pdchs:",o.length,"=>",l[10]),A(function(e){return r.a.uniq(r.a.flatten(e))}(l)).then(t=>{t=r.a.flatten(t),W("DOCS",t);let n=function(e,t){let n,o,s=[],i=[];e.forEach(e=>{let n=[],o=!1,l=!0;e.forEach(e=>{let s=r.a.filter(t,t=>(function(e,t){if(e==t)return!0;let n=new RegExp("^"+t),o=e.replace(n,"");return!(e==o||!x.includes(o))})(e,t.dict));s.length&&(o=!0),s.length||(l=!1);let i={seg:e,docs:s};n.push(i)}),o&&s.push(n),l&&i.push(n)}),i.length?(n=H(i),o=!0):n=H(s);return{chains:n,full:o}}(l,t);W("FULL",n.full),W("CHAINS.length",n.chains.length),W("CHAINS",n.chains),n.chains.length||L(e)})}function H(e){let t=r.a.max(e.map(e=>r.a.sum(e.map(e=>e.docs.length?e.seg.length:0))/e.length)),n=r.a.filter(e,e=>r.a.sum(e.map(e=>e.docs.length?e.seg.length:0))/e.length>=t-1),o=r.a.min(n.map(e=>e.length));return W("MIN",o),r.a.filter(n,e=>e.length==o)}const K=console.log;function $(e){K("PARSE STAR DICT")}function Q(e){K("PARSE STAR CSV")}const X=n(0).remote.require("electron-settings"),Y=(n(16),n(17),n(6),console.log),ee=(n(2),n(5)),{dialog:te,getCurrentWindow:ne}=n(0).remote;n(18);i("#new-version");let oe=i("#container");l('link[rel="import"]').forEach(e=>{let t=e.import.querySelector(".section");oe.appendChild(t.cloneNode(!0))}),s.ipcRenderer.on("section",function(e,t){G({section:t})}),s.ipcRenderer.on("action",function(e,t){"stardict"==t?te.showOpenDialog({properties:["openFile"],filters:[{name:"JSON",extensions:["stardict"]}]},$):"csv"==t?te.showOpenDialog({properties:["openFile"],filters:[{name:"JSON",extensions:["stardict"]}]},Q):"cleanupdb"==t&&O("CLEAN UP")});let re=X.get("state");re||(re={section:"home"}),G(re),document.addEventListener("click",e=>{let t=e.target.dataset;if(t)if(t.external){let t=e.target.textContent;s.shell.openExternal(t)}else t.section&&G({section:t.section})}),document.addEventListener("mouseover",function(e){e.target.textContent&&(e.target.classList.contains("tibphrase")?1==e.shiftKey?function(e){let t=u(e),n=g()(e.textContent),o={top:t.top-40,left:t.left+15},r=i("#transcript");r.textContent=n,r.classList.remove("is-hidden"),p(o,r)}(e.target):Z(e.target):e.target.classList.contains("tibwf")&&v(e.target))},!1),document.addEventListener("mouseleave",function(e){if(e.target.classList)if(e.target.classList.contains("tibphrase")){i("#transcript").classList.add("is-hidden")}else if(e.target.classList.contains("ambi")){Y("MOUSE LEAVE"),i("#ambi").classList.add("is-hidden")}},!1),document.addEventListener("keyup",function(e){i("#transcript").classList.add("is-hidden"),i("#ambi").classList.add("is-hidden")},!1),ee.on("text-changed",()=>{let e=((e,t)=>{let n=new RegExp(B[e]);if(!n.test(t))return;let o=t.trim().replace(/᾽/g,"'"),s=o.split("'").join("");if(!n.test(s))return;let i=new RegExp("([.,!:;·།])"),l=o.replace(/\r?\n+/,"\n").split("\n"),c=(l.map(e=>e.split(i)),[]);return l.forEach(t=>{let o=[];t.split(i).forEach(t=>{if(i.test(t)){let e={text:t,punct:!0};o.push(e)}else{let s=t.split(n);(s=r.a.compact(s)).forEach(t=>{let r={text:t};!!n.test(t)&&(r[e]=!0),o.push(r)})}}),c.push(o)}),c})("tib",ee.readText());e&&e.length&&G({section:"main",pars:e})}).startWatching(),function(){let e=q.get("cfg");e||(e=function(e,t){O("__ZERO CFG__");let n=w.resolve(e,"pouch"),o=y.readdirSync(n),r=[];return o.forEach((e,t)=>{if("cfg.json"==e)return;w.resolve(n,e);let o={name:e,active:!0,idx:t};r.push(o)}),q.set("cfg",r),O("__ZERO CFG__",r),r}(S))}()}]);
//# sourceMappingURL=app.js.map