!function(t){var e={};function n(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(s,o,function(e){return t[e]}.bind(null,o));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=19)}([function(t,e){t.exports=require("electron")},function(t,e){t.exports=require("lodash")},function(t,e){t.exports=require("path")},,function(t,e){t.exports=require("fs-extra")},function(t,e){t.exports=require("electron-clipboard-extended")},function(t,e){t.exports=require("slash")},,function(t,e){t.exports=require("split.js")},function(t,e){t.exports=require("cholok")},,,,function(t,e){t.exports=require("util")},function(t,e){t.exports=require("pouchdb")},function(t,e){t.exports=require("mousetrap")},function(t,e){t.exports=require("json5")},function(t,e){t.exports=require("axios")},function(t,e){t.exports=require("electron-is-dev")},function(t,e,n){"use strict";n.r(e);var s=n(1),o=n.n(s),i=n(0);n(13);function r(t){return document.querySelector(t)}function l(t){return document.querySelectorAll(t)}function c(t,e){let n=document.createElement(t);return e&&n.classList.add(e),n}function a(t,e){let n=document.createElement("span");return n.textContent=t,e&&n.classList.add(e),n}function u(t){if(t)for(;t.hasChildNodes();)t.removeChild(t.lastChild)}function d(t){return t.getBoundingClientRect()}function p(t,e){let n=[t.top,"px"].join(""),s=[t.left,"px"].join("");e.style.top=n,e.style.left=s}var f=n(8),h=n.n(f),g=n(9),m=n.n(g);const b="་",E=["འི","ར","འོ","འམ","འི","ས","འང"];let x=b;const C=console.log;function v(t){if(!t||!t.pars||!t.pars.length)return;let e=t.pars,n=r("#source"),s=r("#result");u(n),u(s),e.forEach(t=>{let e=function(t,e){let n=document.createElement("p");return n.textContent=t,e&&n.classList.add(e),n}();e.classList.add("tibpar"),t.forEach(t=>{let n=a(t.text);t.tib&&n.classList.add("tibphrase"),t.punct&&n.classList.add("punct")," "==t.text&&n.classList.add("space"),e.appendChild(n)}),n.appendChild(e)});l("span.tibetan")}function L(t){let e=d(t),n=m()(t.textContent),s={top:e.top-40,left:e.left+15},o=r("#transcript");o.textContent=n,o.classList.remove("is-hidden"),p(s,o)}function y(t){let e=r("#ambi"),n=d(t);u(e),e.classList.remove("is-hidden"),p({top:n.bottom+2,left:n.left},e);let s=c("ul","ambilist");return e.appendChild(s),s}function S(t){let e;try{e=JSON.parse(t.dataset.chains)}catch(t){return void C("ERR: JSON chains")}let n=y(t);n.classList.add("danger"),e.forEach(t=>{let e=c("li","ambiline");n.appendChild(e),t.forEach(t=>{let n=t.docs.length?a(t.seg,"tibwf"):a(t.seg,"tibphrase");t.docs.length&&(n.dataset.docs=JSON.stringify(t.docs)),e.appendChild(n)})})}const w=n(2);let O=n(4);const N=i.remote.app,R=(N.getAppPath(),N.getPath("userData")),q=i.remote.require("electron-settings"),_=console.log,j=n(14);let A=[],J=w.resolve(R,"pouch");function D(t){return A.length||P(),function(t){return Promise.all(A.map(function(e){return e.allDocs({keys:t,include_docs:!0}).then(function(t){if(!t||!t.rows)throw new Error("no dbn result");let n=o.a.compact(t.rows.map(t=>t.doc)),s=o.a.flatten(o.a.compact(n.map(t=>t.docs)));return s.length?(s.forEach(t=>{t.dname=e.dname,t.weight=e.weight}),s):[]}).catch(function(t){console.log("ERR GET DBs",t)})}))}(t)}function P(){let t=q.get("cfg");_("===setDBs CFG===",t),o.a.compact(t.map(t=>t.active?t.name:null)).forEach((t,e)=>{let n=w.resolve(R,"pouch",t),s=new j(n);s.dname=t,s.weight=e,A.push(s)})}O.ensureDirSync(J);const M=console.log,T=(n(5),n(0).remote.require("electron-settings")),k=n(15),{getCurrentWindow:z}=(n(4),n(2),n(6),n(0).remote);let F,I=[],U=0;function B(t){!function(){const t=document.querySelectorAll(".section.is-shown");Array.prototype.forEach.call(t,t=>{t.classList.remove("is-shown")}),r("#transcript").classList.add("is-hidden"),r("#ambi").classList.add("is-hidden")}(),r(["#",t].join("")).classList.add("is-shown")}function G(t){try{t=JSON.parse(JSON.stringify(t))}catch(e){M("NAV-state ERR",e),t={}}let e=t.section||"home";e||(t.section="home"),B(t.section),t.old||(t.old=!1,delete t.old,I.push(t),U=I.length-1);let n=r("#progress");"main"==e?(function(t){let e=T.get("split-sizes")||[50,50];F&&t.mono?F.collapse(1):F&&F.setSizes(e),F||(T.set("split-sizes",e),F=h()(["#source","#result"],{sizes:e,gutterSize:5,cursor:"col-resize",minSize:[0,0],onDragEnd:function(t){T.set("split-sizes",t),z().reload()}}),t.mono&&F.collapse(1),document.addEventListener("keydown",function(t){},!1),document.addEventListener("wheel",function(t){},!1))}(t),v(t)):n.classList.remove("is-shown"),t={section:"home"},T.set("state",t)}k.bind(["alt+left","alt+right"],function(t){37==t.which?function(){if(U<=0)return;U--;let t=I[U];t.old=!0,G(t)}():39==t.which&&function(){if(U>=I.length-1)return;U++;let t=I[U];t.old=!0,G(t)}()}),k.bind(["alt+1","alt+2"],function(t){}),k.bind(["esc"],function(t){}),k.bind(["ctrl+k"],function(t){M("CLICK CLONE"),function(){A.length||P();let t=o.a.find(A,t=>"vasilyev"==t.dname);_("DB-name",t.dname);let e=new j("http://localhost:5984/vasilyev");t.replicate.to(e).on("complete",function(){_("yay, were done!")}).on("error",function(t){_("boo, something went wrong!",t)})}()}),k.bind(["ctrl+p"],function(t){M("ZERO CFG"),T.set("cfg","")});console.log;let K={zho:"([一-鿿]+)",tib:"([ༀ-࿿]+)",grc:"([Ͱ-Ͽἀ-῿̀-ͯ']+)"};console.log;const V=b;function W(t){let e,n,s=[];for(let o=1;o<t.length+1;o++){let i={head:e=t.slice(0,o),tail:n=t.slice(o)};n.length&&s.push(i)}return s.reverse()}let Z=b;const H=console.log;function $(t,e){let n=r("#progress");n.classList.add("is-shown");let s=new RegExp(Z+"$"),i=t.textContent.trim().replace(s,""),l=i.split(Z),d=!1;t.parentNode.classList.contains("tibphrase")&&(d=!0);let p=function(t){let e=t.split(V),n=e.length<15?10:2,s=t,i=(e.length,[[e]]);!function t(e,r){W(e).forEach(e=>{r.push(e.head),r.push(e.tail),o.a.flatten(r).join(V)==s&&(i.push(o.a.clone(r)),r.pop()),r.length<n&&t(e.tail,r),r.pop()})}(e,[]);let r=[];return i.forEach(t=>{let e=[];t.forEach(t=>{e.push(t.join(V))}),r.push(e)}),r}(i);H("MAIN pdchs:",l.length,"=>",p.length),H("MAIN pdchs:",l.length,"=>",p[10]);let f=function(t){return o.a.uniq(o.a.flatten(t))}(p);e&&(f=o.a.filter(f,t=>t!=i)),D(f).then(s=>{s=o.a.flatten(s),H("DOCS",s);let i,l=function(t,e){let n,s,i=[],r=[];t.forEach(t=>{let n=[],s=!1,l=!0;t.forEach(t=>{let i=o.a.filter(e,e=>(function(t,e){if(t==e)return!0;let n=new RegExp("^"+e),s=t.replace(n,"");return!(t==s||!E.includes(s))})(t,e.dict));i.length&&(s=!0),i.length||(l=!1);let r={seg:t,docs:i};n.push(r)}),s&&i.push(n),l&&r.push(n)}),r.length?(n=Q(r),s=!0):n=Q(i);return{chains:n,full:s}}(p,s),d=l.chains;H("FULL, CHAINS",l.full,d.length,d),d.length?(d.length>1?(i=function(t){let e,n=t[0],s=[];for(let i=0;i<n.length;i++){let r=t.map(t=>t[i].seg);if(1==o.a.uniq(r).length)s.push(n[i]),e=null;else{e||(e={ambi:!0,seg:"",docs:[]},s.push(e));let n=t.map(t=>({seg:t[i].seg,docs:t[i].docs}));e.docs.push(n)}}let i=o.a.filter(s,t=>t.ambi);return i.forEach(t=>{let e=t.docs[0],n=[];for(let s=0;s<e.length;s++){let e=t.docs.map(t=>t[s]);n.push(e)}t.chains=n;let s=n[0];t.seg=s.map(t=>t.seg).join(Z)}),H("___AMBIS___",i),s}(d),H("COMMON",i)):1==d.length&&(i=d[0]),H("CHAIN:",i),H("STRUCT:",e,t.dataset.docs),e?function(t,e){C("COMPOUND",t.textContent,e);let n=y(t);e.length>1?S(t):e[0].forEach(t=>{let e=c("li","ambiline");n.appendChild(e);let s=t.docs.length?a(t.seg,"tibwf"):a(t.seg,"tibphrase");e.appendChild(s),s.dataset.docs=JSON.stringify(t.docs)})}(t,d):function(t,e){t.textContent="",e.forEach((n,s)=>{let o;n.ambi?(o=a(n.seg,"tibambi")).dataset.chains=JSON.stringify(n.chains):n.docs.length?(o=a(n.seg,"tibwf")).dataset.docs=JSON.stringify(n.docs):o=a(n.seg,"tibphrase"),t.appendChild(o),s<e.length-1&&t.appendChild(a(x,"tsek"))})}(t,i),n.classList.remove("is-shown")):function(t){C("NO RESULT"),u(r("#result")),r("#progress").classList.remove("is-shown")}()})}function Q(t){let e=o.a.max(t.map(t=>o.a.sum(t.map(t=>t.docs.length?t.seg.length:0))/t.length)),n=o.a.filter(t,t=>o.a.sum(t.map(t=>t.docs.length?t.seg.length:0))/t.length>=e-1),s=o.a.min(n.map(t=>t.length));return o.a.filter(n,t=>t.length==s)}const X=console.log;function Y(t){X("PARSE STAR DICT")}function tt(t){X("PARSE STAR CSV")}const et=n(0).remote.require("electron-settings"),nt=(n(16),n(17),n(6),console.log),st=(n(2),n(5)),{dialog:ot,getCurrentWindow:it}=n(0).remote;n(18);r("#new-version");let rt=r("#container");l('link[rel="import"]').forEach(t=>{let e=t.import.querySelector(".section");rt.appendChild(e.cloneNode(!0))}),i.ipcRenderer.on("section",function(t,e){G({section:e})}),i.ipcRenderer.on("action",function(t,e){"stardict"==e?ot.showOpenDialog({properties:["openFile"],filters:[{name:"JSON",extensions:["stardict"]}]},Y):"csv"==e?ot.showOpenDialog({properties:["openFile"],filters:[{name:"JSON",extensions:["stardict"]}]},tt):"cleanupdb"==e&&_("CLEAN UP")});let lt=et.get("state");function ct(){r("#transcript").classList.add("is-hidden"),r("#ambi").classList.add("is-hidden")}lt||(lt={section:"home"}),G(lt),document.addEventListener("click",t=>{let e=t.target.dataset;if(e)if(e.external){let e=t.target.textContent;i.shell.openExternal(e)}else e.section?G({section:e.section}):e.docs&&$(t.target,!0)}),document.addEventListener("mouseover",function(t){if(t.target.textContent)if(t.target.classList.contains("tibphrase"))1==t.shiftKey?L(t.target):$(t.target);else if(t.target.classList.contains("tibwf")){t.target.parentNode.classList.contains("tibphrase")&&ct(),function(t){r("#source");let e=r("#result");u(e);let n=t.textContent,s=JSON.parse(t.dataset.docs);try{s=JSON.parse(t.dataset.docs)}catch(t){return void C("ERR: JSON docs")}let o=c("div","dict");e.appendChild(o);let i=c("p","dict-wf");i.textContent=n,o.appendChild(i),s.forEach(t=>{let e=c("p","dict-dname");e.textContent=t.dname,o.appendChild(e);let n=c("p","dict-article");n.textContent=t.dict,o.appendChild(n);let s=c("ul","dict-ul");o.appendChild(s),t.trns||C("NO TRNS",t),t.trns&&t.trns.forEach(t=>{let e=c("li","dict-line");e.textContent=t,s.appendChild(e)})})}(t.target)}else t.target.classList.contains("tibambi")&&S(t.target)},!1),document.addEventListener("mouseleave",function(t){if(t.target.classList)if(t.target.classList.contains("tibphrase")){r("#transcript").classList.add("is-hidden")}else t.target.classList.contains("ambi")&&nt("MOUSE LEAVE")},!1),document.addEventListener("keyup",function(t){ct()},!1),document.addEventListener("keydown",function(t){if(ct(),1!=t.shiftKey)return;L([].slice.call(document.querySelectorAll(":hover")).pop())},!1),st.on("text-changed",()=>{let t=((t,e)=>{let n=new RegExp(K[t]);if(!n.test(e))return;let s=e.trim().replace(/᾽/g,"'"),i=s.split("'").join("");if(!n.test(i))return;let r=new RegExp("([.,!:;·།])"),l=s.replace(/\r?\n+/,"\n").split("\n"),c=(l.map(t=>t.split(r)),[]);return l.forEach(e=>{let s=[];e.split(r).forEach(e=>{if(r.test(e)){let t={text:e,punct:!0};s.push(t)}else{let i=e.split(n);(i=o.a.compact(i)).forEach(e=>{let o={text:e};!!n.test(e)&&(o[t]=!0),s.push(o)})}}),c.push(s)}),c})("tib",st.readText());t&&t.length&&G({section:"main",pars:t})}).startWatching(),function(){let t=q.get("cfg");t||(t=function(t,e){_("__ZERO CFG__");let n=w.resolve(t,"pouch"),s=O.readdirSync(n),o=[];return s.forEach((t,e)=>{if("cfg.json"==t)return;w.resolve(n,t);let s={name:t,active:!0,idx:e};o.push(s)}),q.set("cfg",o),_("__ZERO CFG__",o),o}(R))}()}]);
//# sourceMappingURL=app.js.map