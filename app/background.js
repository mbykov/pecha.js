!function(e){var n={};function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=n,o.d=function(e,n,t){o.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,n){if(1&n&&(e=o(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)o.d(t,r,function(n){return e[n]}.bind(null,r));return t},o.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="",o(o.s=22)}([function(e,n){e.exports=require("electron")},function(e,n){e.exports=require("lodash")},function(e,n,o){"use strict";o.d(n,"g",function(){return p}),o.d(n,"a",function(){return b}),o.d(n,"c",function(){return w}),o.d(n,"b",function(){return g}),o.d(n,"f",function(){return m}),o.d(n,"e",function(){return h}),o.d(n,"d",function(){return v});var t=o(1),r=o.n(t);const c=o(3),i=o(5),s=o(6),l=console.log,a=o(8),u=(o(7),o(9));new u,new u({host:"couchdb.external.service",protocol:"https",port:6984}),new u({auth:{user:"login",pass:"secret"}});let d=[];function p(e){let n=s.get("cfg");n||(n=f(e)),l("===setDBs CFG===",n);let o=r.a.compact(n.map(e=>e.active?e.name:null));return l("POUCH:DBNS",o),o.forEach((n,o)=>{let t=c.resolve(e,"pouch",n),r=new a(t);r.dname=n,r.weight=o,d.push(r)}),o}function b(e){let n=s.get("cfg");return n||(n=f(e)),n}function f(e,n){let o=c.resolve(e,"pouch");i.ensureDirSync(o);let t=i.readdirSync(o),r=[];return t.forEach((e,n)=>{if("cfg.json"==e)return;c.resolve(o,e);let t={name:e,active:!0,idx:n};r.push(t)}),s.set("cfg",r),r}function w(e){return l("qqqDBs",d.length),Promise.all(d.map(function(n){return n.allDocs({keys:e,include_docs:!0}).then(function(e){if(!e||!e.rows)throw new Error("no dbn result");let o=r.a.compact(e.rows.map(e=>e.doc)),t=r.a.flatten(r.a.compact(o.map(e=>e.docs)));return t.length?(t.forEach(e=>{e.dname=n.dname,e.weight=n.weight}),t):[]}).catch(function(e){console.log("ERR GET DBs",e)})}))}function g(e){return new a(e).info()}function m(e,n){}function h(e,n,o){let t=new a(n),r=new a(e);r.replicate.to(t).then(function(e){l("REPLICATION COMPLETED",e),o(!0)}).catch(function(e){l(e),o(!1)}),t.replicate.from(r,{batch_size:1e3}).on("complete",function(e){l("REPL",e),o(!0)}).on("error",function(e){l("____ERR",e),o(!1)})}function v(e){curl.get("http://localhost:5984/_all_dbs",{},function(n,o,t){if(n)e("something goes wrong, no connection?");else if(200==o.statusCode)try{let o=JSON.parse(t);e(o)}catch(n){e(n)}else e(o.statusCode)})}},function(e,n){e.exports=require("path")},function(e){e.exports={name:"development",description:"Add here any environment specific stuff you like."}},function(e,n){e.exports=require("fs-extra")},function(e,n){e.exports=require("electron-settings")},function(e,n){e.exports=require("electron-is-dev")},function(e,n){e.exports=require("pouchdb")},function(e,n){e.exports=require("node-couchdb")},,,function(e,n){e.exports=require("url")},,,function(e,n){e.exports=require("electron-window-state")},function(e){e.exports={name:"pecha.js",productName:"Pecha.js",description:"Starter for your Electron application",version:"0.1.0",private:!0,author:"Mr. Gumby <mr.gumby@example.com>",copyright:"Â© 2017, Gumby inc.",homepage:"http://example.com",main:"app/background.js",build:{appId:"com.example.electron-boilerplate",files:["app/**/*","node_modules/**/*","package.json"],directories:{buildResources:"resources"},publish:null},scripts:{postinstall:"electron-builder install-app-deps",preunit:"webpack --config=build/webpack.unit.config.js --env=test --display=none",unit:"electron-mocha temp/specs.js --renderer --require source-map-support/register",pree2e:"webpack --config=build/webpack.app.config.js --env=test --display=none && webpack --config=build/webpack.e2e.config.js --env=test --display=none",e2e:"mocha temp/e2e.js --require source-map-support/register",test:"npm run unit && npm run e2e",start:"node build/start.js",release:"npm test && webpack --config=build/webpack.app.config.js --env=production && electron-builder"},dependencies:{axios:"^0.18.0",cholok:"^0.1.5",curl:"^0.1.4",debug:"^4.1.1","directory-tree":"^2.1.0","electron-clipboard-extended":"^1.1.1","electron-is-dev":"^1.0.1","electron-settings":"^3.2.0","electron-window-state":"^5.0.2","file-loader":"^2.0.0","franc-all":"^5.0.0","fs-extra":"^7.0.1","fs-jetpack":"^2.2.0","git-clone":"^0.1.0",glob:"^7.1.3",json5:"^2.1.0",lodash:"^4.17.11",mousetrap:"^1.6.2","node-couchdb":"^1.3.0",pouchdb:"^7.0.0","pouchdb-find":"^7.0.0","pouchdb-quick-search":"^1.3.0",slash:"^2.0.0","split.js":"^1.4.0",textract:"^2.4.0"},devDependencies:{"@babel/core":"^7.1.2","@babel/preset-env":"^7.1.0","babel-loader":"^8.0.4","babel-plugin-transform-object-rest-spread":"^7.0.0-beta.3",chai:"^4.2.0","css-loader":"^0.28.7",electron:"4.0.4","electron-builder":"^20.38.5","electron-mocha":"^6.0.4",mocha:"^5.2.0","source-map-support":"^0.5.9",spectron:"^4.0.0","style-loader":"^0.23.0","friendly-errors-webpack-plugin":"^1.7.0",webpack:"^4.20.2","webpack-cli":"^3.1.2","webpack-merge":"^4.1.4","webpack-node-externals":"^1.7.2"}}},,,,,,function(e,n,o){"use strict";o.r(n);var t=o(3),r=o.n(t),c=o(12),i=o.n(c),s=o(0);const l={label:"File",submenu:[{label:"Home",accelerator:"CmdOrCtrl+L",click:()=>{s.BrowserWindow.getFocusedWindow().webContents.send("section","home")}},{label:"Quit",accelerator:"CmdOrCtrl+Q",click:()=>{s.app.quit()}}]},a={label:"About",submenu:[{label:"What does this program do?",click:()=>{s.BrowserWindow.getFocusedWindow().webContents.send("action","about")}},{label:"Code and Download",click:()=>{s.BrowserWindow.getFocusedWindow().webContents.send("action","code")}},{label:"License",click:()=>{s.BrowserWindow.getFocusedWindow().webContents.send("action","license")}},{label:"Acknowledgements",click:()=>{s.BrowserWindow.getFocusedWindow().webContents.send("action","acknowledgements")}}]},u={label:"Dict",submenu:[{label:"clone dicts from server",click:()=>{s.BrowserWindow.getFocusedWindow().webContents.send("action","clonedicts")}},{label:"arrange local dicts",click:()=>{s.BrowserWindow.getFocusedWindow().webContents.send("action","arrangeDicts")}},{label:"export CSV to dict",click:()=>{s.BrowserWindow.getFocusedWindow().webContents.send("action","csv")}},{label:"create CSV dict from texts",click:()=>{s.BrowserWindow.getFocusedWindow().webContents.send("action","localdict")}},{label:"upload dict to server (disabled)",click:()=>{s.BrowserWindow.getFocusedWindow().webContents.send("action","upload")}},{label:"cleanup DBs completely",click:()=>{s.BrowserWindow.getFocusedWindow().webContents.send("action","cleanupdb")}}]},d={label:"Help",submenu:[{label:"hot keys",click:()=>{s.BrowserWindow.getFocusedWindow().webContents.send("action","hotkeys")}},{label:"Toggle DevTools",accelerator:"Alt+CmdOrCtrl+I",click:()=>{s.BrowserWindow.getFocusedWindow().toggleDevTools()}}]};var p=o(2);var b=o(4);const f=o(15),w=(o(6),console.log);if("production"!==b.name){const e=s.app.getPath("userData");s.app.setPath("userData",`${e} (${b.name})`)}s.app.on("ready",()=>{(()=>{const e=[l,u,a,d];b.name,s.Menu.setApplicationMenu(s.Menu.buildFromTemplate(e))})();let e=f({defaultWidth:1e3,defaultHeight:800});const n=new s.BrowserWindow({x:e.x,y:e.y,width:e.width,height:e.height,webPreferences:{nodeIntegration:!0}});n.loadURL(i.a.format({pathname:r.a.join(__dirname,"app.html"),protocol:"file:",slashes:!0})),"development"===b.name&&n.openDevTools(),n.webContents.on("did-finish-load",()=>{let e=o(16),t=e.name,r=e.version;n.webContents.send("version",r),n.setTitle([t,"v.",r].join(" "))}),n.on("resize",function(){n.webContents.send("reload")}),s.globalShortcut.register("CommandOrControl+R",()=>n.webContents.send("reread")),s.globalShortcut.register("CommandOrControl+Shift+R",()=>n.reload());s.app.getAppPath();const t=s.app.getPath("userData");let c=r.a.resolve(t,"pouch","vasilyev"),g=["http://localhost:5984","vasilyev"].join("/"),m=Object(p.g)(t);console.log("B:dbnames",m);let h=Object(p.a)(t);console.log("CFG",h),s.ipcMain.on("replicate",(e,n)=>{console.log("B:REPLICATE",n),Object(p.e)(g,c,function(e){console.log("REPL RES:",e)})}),s.ipcMain.on("info",(e,n)=>{let o=r.a.resolve(t,"pouch","vasilyev");console.log("B:INFO",n),Object(p.b)(o).then(function(e){console.log("B: INFO:",e)})}),s.ipcMain.on("queryDBs",(e,n)=>{Object(p.c)(n.keys).then(function(o){w("RES",o.length),n.docs=o,e.sender.send("replayDBs",n)})})}),s.app.on("window-all-closed",()=>{s.app.quit()})}]);
//# sourceMappingURL=background.js.map