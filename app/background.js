!function(e){var o={};function n(t){if(o[t])return o[t].exports;var r=o[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=o,n.d=function(e,o,t){n.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:t})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,o){if(1&o&&(e=n(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var r in e)n.d(t,r,function(o){return e[o]}.bind(null,r));return t},n.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(o,"a",o),o},n.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},n.p="",n(n.s=23)}([function(e,o){e.exports=require("electron")},function(e,o){e.exports=require("lodash")},function(e,o,n){"use strict";n.d(o,"c",function(){return b}),n.d(o,"d",function(){return f}),n.d(o,"a",function(){return w}),n.d(o,"b",function(){return m});var t=n(1),r=n.n(t);const c=n(3),s=n(6),i=(n(7),n(4)),a=console.log,l=n(8);l.plugin(n(9));let d=[];const u=n(10),p=new u;new u({host:"couchdb.external.service",protocol:"https",port:6984}),new u({auth:{user:"login",pass:"secret"}});function b(){return p.listDatabases().catch(function(e){a("REMOTE DICTS ERR",e)})}function f(e,o){a("REPLICATE LOCAL",o);let n=new l(o);return n.info().then(function(e){return a("REPL-BEFORE-INFO",e),n.load("http://localhost:3000/api/vasilyev")})}function w(){let e=i.get("upath"),o=c.resolve(e,"pouch"),n=s.readdirSync(o),t=i.get("cfg")||[],u=[];return n.forEach((e,o)=>{let n=r.a.find(t,o=>o.name==e);if(n)u.push(n);else{let n={name:e,active:!0,idx:100+o};u.push(n)}}),(u=r.a.sortBy(u,"idx")).forEach((e,o)=>{e.idx=o}),i.set("cfg",u),function(e,o){d=[];let n=r.a.compact(o.map(e=>e.active?e.name:null));a("setDBNS",n),n.forEach((o,n)=>{let t=c.resolve(e,"pouch",o),r=new l(t);r.dname=o,r.weight=n,d.push(r)})}(e,u),u}function m(e){return Promise.all(d.map(function(o){return o.allDocs({keys:e,include_docs:!0}).then(function(e){if(!e||!e.rows)throw new Error("no dbn result");let n=r.a.compact(e.rows.map(e=>e.doc)),t=r.a.flatten(r.a.compact(n.map(e=>e.docs)));return t.length?(t.forEach(e=>{e.dname=o.dname,e.weight=o.weight}),a("======DOCS",t),t):[]}).catch(function(e){console.log("ERR GET DBs",e)})}))}},function(e,o){e.exports=require("path")},function(e,o){e.exports=require("electron-settings")},function(e){e.exports={name:"development",description:"Add here any environment specific stuff you like."}},function(e,o){e.exports=require("fs-extra")},function(e,o){e.exports=require("electron-is-dev")},function(e,o){e.exports=require("pouchdb")},function(e,o){e.exports=require("pouchdb-load")},function(e,o){e.exports=require("node-couchdb")},,,function(e,o){e.exports=require("url")},,,function(e){e.exports={name:"pecha.js",productName:"Pecha.js",description:"Starter for your Electron application",version:"0.1.0",private:!0,author:"Mr. Gumby <mr.gumby@example.com>",copyright:"Â© 2017, Gumby inc.",homepage:"http://example.com",main:"app/background.js",build:{appId:"com.example.electron-boilerplate",files:["app/**/*","node_modules/**/*","package.json"],directories:{buildResources:"resources"},publish:null},scripts:{postinstall:"electron-builder install-app-deps",preunit:"webpack --config=build/webpack.unit.config.js --env=test --display=none",unit:"electron-mocha temp/specs.js --renderer --require source-map-support/register",pree2e:"webpack --config=build/webpack.app.config.js --env=test --display=none && webpack --config=build/webpack.e2e.config.js --env=test --display=none",e2e:"mocha temp/e2e.js --require source-map-support/register",test:"npm run unit && npm run e2e",start:"node build/start.js",release:"npm test && webpack --config=build/webpack.app.config.js --env=production && electron-builder"},dependencies:{axios:"^0.18.0",cholok:"^0.1.5",curl:"^0.1.4",debug:"^4.1.1","directory-tree":"^2.1.0","electron-clipboard-extended":"^1.1.1","electron-is-dev":"^1.0.1","electron-settings":"^3.2.0","file-loader":"^2.0.0","franc-all":"^5.0.0","fs-extra":"^7.0.1","fs-jetpack":"^2.2.0","git-clone":"^0.1.0",glob:"^7.1.3",json5:"^2.1.0",lodash:"^4.17.11",memorystream:"^0.3.1",mousetrap:"^1.6.2","node-couchdb":"^1.3.0",pouchdb:"^7.0.0","pouchdb-authentication":"^1.1.3","pouchdb-find":"^7.0.0","pouchdb-load":"^1.4.6","pouchdb-quick-search":"^1.3.0","pouchdb-replication-stream":"^1.2.9",slash:"^2.0.0","split.js":"^1.4.0",textract:"^2.4.0"},devDependencies:{"@babel/core":"^7.1.2","@babel/preset-env":"^7.1.0","babel-loader":"^8.0.4","babel-plugin-transform-object-rest-spread":"^7.0.0-beta.3",chai:"^4.2.0","css-loader":"^0.28.7",electron:"4.0.4","electron-builder":"^20.38.5","electron-mocha":"^6.0.4",mocha:"^5.2.0","source-map-support":"^0.5.9",spectron:"^4.0.0","style-loader":"^0.23.0","friendly-errors-webpack-plugin":"^1.7.0",webpack:"^4.20.2","webpack-cli":"^3.1.2","webpack-merge":"^4.1.4","webpack-node-externals":"^1.7.2"}}},,,,,,,function(e,o,n){"use strict";n.r(o);var t=n(1),r=n.n(t),c=n(3),s=n.n(c),i=n(13),a=n.n(i),l=n(0);const d={label:"File",submenu:[{label:"Home",accelerator:"CmdOrCtrl+L",click:()=>{l.BrowserWindow.getFocusedWindow().webContents.send("section","home")}},{label:"Quit",accelerator:"CmdOrCtrl+Q",click:()=>{l.app.quit()}}]},u={label:"About",submenu:[{label:"What does this program do?",click:()=>{l.BrowserWindow.getFocusedWindow().webContents.send("section","about")}},{label:"Code and Download",click:()=>{l.BrowserWindow.getFocusedWindow().webContents.send("section","code")}},{label:"License",click:()=>{l.BrowserWindow.getFocusedWindow().webContents.send("section","license")}},{label:"Contacts",click:()=>{l.BrowserWindow.getFocusedWindow().webContents.send("section","contacts")}},{label:"Acknowledgements",click:()=>{l.BrowserWindow.getFocusedWindow().webContents.send("section","acknowledgements")}}]},p={label:"Dict",submenu:[{label:"Clone dicts from server",click:()=>{l.BrowserWindow.getFocusedWindow().webContents.send("section","clonedicts")}},{label:"Arrange local dicts",click:()=>{l.BrowserWindow.getFocusedWindow().webContents.send("section","activedicts")}},{label:"Create CSV dict from texts",click:()=>{l.BrowserWindow.getFocusedWindow().webContents.send("action","localdict")}},{label:"Convert CSV to dict",click:()=>{l.BrowserWindow.getFocusedWindow().webContents.send("action","csv")}},{label:"upload new dict to server (disabled)",click:()=>{l.BrowserWindow.getFocusedWindow().webContents.send("action","upload")}},{label:"Cleanup DBs completely",click:()=>{l.BrowserWindow.getFocusedWindow().webContents.send("section","cleanup")}}]},b={label:"Help",submenu:[{label:"hot keys",click:()=>{l.BrowserWindow.getFocusedWindow().webContents.send("section","help")}},{label:"Toggle DevTools",accelerator:"Alt+CmdOrCtrl+I",click:()=>{l.BrowserWindow.getFocusedWindow().toggleDevTools()}}]};var f=n(2);var w=n(5);const m=n(4),h=console.log;if("production"!==w.name){const e=l.app.getPath("userData");l.app.setPath("userData",`${e} (${w.name})`)}l.app.on("ready",()=>{(()=>{const e=[d,p,u,b];w.name,l.Menu.setApplicationMenu(l.Menu.buildFromTemplate(e))})();let e=m.get("winBounds");e.y-=21,h("winBounds",e);const o=new l.BrowserWindow({webPreferences:{nodeIntegration:!0}});o.setBounds(e),o.loadURL(a.a.format({pathname:s.a.join(__dirname,"app.html"),protocol:"file:",slashes:!0})),"development"===w.name&&o.openDevTools(),o.webContents.on("did-finish-load",()=>{let e=n(16),t=e.name,r=e.version;o.webContents.send("version",r),o.setTitle([t,"v.",r].join(" "))}),o.on("resize",function(){o.webContents.send("reload")}),o.on("close",()=>{m.set("winBounds",o.getBounds())}),l.globalShortcut.register("CommandOrControl+Shift+R",()=>o.reload());const t=l.app.getAppPath(),c=l.app.getPath("userData");m.set("apath",t),m.set("upath",c),Object(f.a)();s.a.resolve(c,"pouch","vasilyev");let i=["http://localhost:5984","vasilyev"].join("/");l.ipcMain.on("replicate",(e,o)=>{console.log("B:REPLICATE",o);let n=s.a.resolve(c,"pouch",o);Object(f.d)(i,n).then(function(o){console.log("Hooray the stream replication is complete!",o),Object(f.a)(),e.sender.send("replicateOK",o)}).catch(function(e){console.log("oh no an error",e)})}),l.ipcMain.on("queryDBs",(e,o)=>{Object(f.b)(o.keys).then(function(n){o.docs=n,e.sender.send("replayDBs",o)})}),l.ipcMain.on("remoteDicts",(e,o)=>{h("B: REMOTE DICTS START"),Object(f.c)().then(function(o){h("REMOTE DICTS",o),o=r.a.filter(o,e=>"_"!=e[0]),e.sender.send("remoteDictsReply",o)})})}),l.app.on("window-all-closed",()=>{l.app.quit()})}]);
//# sourceMappingURL=background.js.map